<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 ネットワーク指標の算出 | Network Analysis Using R</title>
  <meta name="description" content="3 ネットワーク指標の算出 | Network Analysis Using R" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="3 ネットワーク指標の算出 | Network Analysis Using R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 ネットワーク指標の算出 | Network Analysis Using R" />
  
  
  

<meta name="author" content="Tsubasa Yamaguchi" />


<meta name="date" content="2022-11-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="c2.html"/>
<link rel="next" href="おまけ.-csiの算出.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.23/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="custom_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本稿の目的</a></li>
<li class="chapter" data-level="" data-path="パッケージの読み込み.html"><a href="パッケージの読み込み.html"><i class="fa fa-check"></i>0. パッケージの読み込み</a></li>
<li class="chapter" data-level="1" data-path="c1.html"><a href="c1.html"><i class="fa fa-check"></i><b>1</b> 社会ネットワーク分析の概説</a>
<ul>
<li class="chapter" data-level="1.1" data-path="c1.html"><a href="c1.html#社会ネットワーク分析snaとは"><i class="fa fa-check"></i><b>1.1</b> 社会ネットワーク分析(SNA)とは</a></li>
<li class="chapter" data-level="1.2" data-path="c1.html"><a href="c1.html#社会ネットワークの基礎"><i class="fa fa-check"></i><b>1.2</b> 社会ネットワークの基礎</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="c1.html"><a href="c1.html#グラフ"><i class="fa fa-check"></i><b>1.2.1</b> グラフ</a></li>
<li class="chapter" data-level="1.2.2" data-path="c1.html"><a href="c1.html#隣接行列マトリックス"><i class="fa fa-check"></i><b>1.2.2</b> 隣接行列(マトリックス)</a></li>
<li class="chapter" data-level="1.2.3" data-path="c1.html"><a href="c1.html#rでのグラフの描画"><i class="fa fa-check"></i><b>1.2.3</b> Rでのグラフの描画</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="c2.html"><a href="c2.html"><i class="fa fa-check"></i><b>2</b> データの読み込みとマトリックスの作成</a>
<ul>
<li class="chapter" data-level="2.1" data-path="c2.html"><a href="c2.html#s2-1"><i class="fa fa-check"></i><b>2.1</b> 2個体間のassociationを記録したデータフレーム</a></li>
<li class="chapter" data-level="2.2" data-path="c2.html"><a href="c2.html#group-by-individual"><i class="fa fa-check"></i><b>2.2</b> Group by individual</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="c3.html"><a href="c3.html"><i class="fa fa-check"></i><b>3</b> ネットワーク指標の算出</a>
<ul>
<li class="chapter" data-level="3.1" data-path="c3.html"><a href="c3.html#ノードについての諸指標中心性指標"><i class="fa fa-check"></i><b>3.1</b> ノードについての諸指標(中心性指標)</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="c3.html"><a href="c3.html#次数中心性degree-centrality"><i class="fa fa-check"></i><b>3.1.1</b> 次数中心性(Degree centrality)</a></li>
<li class="chapter" data-level="3.1.2" data-path="c3.html"><a href="c3.html#重み付き中心性strength-centrality"><i class="fa fa-check"></i><b>3.1.2</b> 重み付き中心性(Strength centrality)</a></li>
<li class="chapter" data-level="3.1.3" data-path="c3.html"><a href="c3.html#固有ベクトル中心性eigenvector-centrality"><i class="fa fa-check"></i><b>3.1.3</b> 固有ベクトル中心性(Eigenvector centrality)</a></li>
<li class="chapter" data-level="3.1.4" data-path="c3.html"><a href="c3.html#pagerank"><i class="fa fa-check"></i><b>3.1.4</b> PageRank</a></li>
<li class="chapter" data-level="3.1.5" data-path="c3.html"><a href="c3.html#媒介中心性betweeness-centrality"><i class="fa fa-check"></i><b>3.1.5</b> 媒介中心性(Betweeness centrality)</a></li>
<li class="chapter" data-level="3.1.6" data-path="c3.html"><a href="c3.html#情報中心性information-centrality"><i class="fa fa-check"></i><b>3.1.6</b> 情報中心性(Information centrality)</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="c3.html"><a href="c3.html#ネットワーク構造の諸指標"><i class="fa fa-check"></i><b>3.2</b> ネットワーク構造の諸指標</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="c3.html"><a href="c3.html#集中度centralization"><i class="fa fa-check"></i><b>3.2.1</b> 集中度(Centralization)</a></li>
<li class="chapter" data-level="3.2.2" data-path="c3.html"><a href="c3.html#密度density"><i class="fa fa-check"></i><b>3.2.2</b> 密度(Density)</a></li>
<li class="chapter" data-level="3.2.3" data-path="c3.html"><a href="c3.html#同類性assortativity"><i class="fa fa-check"></i><b>3.2.3</b> 同類性(Assortativity)</a></li>
<li class="chapter" data-level="3.2.4" data-path="c3.html"><a href="c3.html#推移性transitivity"><i class="fa fa-check"></i><b>3.2.4</b> 推移性(Transitivity)</a></li>
<li class="chapter" data-level="3.2.5" data-path="c3.html"><a href="c3.html#modularity"><i class="fa fa-check"></i><b>3.2.5</b> Modularity</a></li>
<li class="chapter" data-level="3.2.6" data-path="c3.html"><a href="c3.html#応用例下位集団の検出"><i class="fa fa-check"></i><b>3.2.6</b> 応用例(下位集団の検出)</a></li>
<li class="chapter" data-level="3.2.7" data-path="c3.html"><a href="c3.html#その他"><i class="fa fa-check"></i><b>3.2.7</b> その他</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="おまけ.-csiの算出.html"><a href="おまけ.-csiの算出.html"><i class="fa fa-check"></i><b>4</b> おまけ. CSIの算出</a></li>
<li class="chapter" data-level="" data-path="実行環境.html"><a href="実行環境.html"><i class="fa fa-check"></i>実行環境</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Network Analysis Using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="c3" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> ネットワーク指標の算出<a href="c3.html#c3" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>本章では、ネットワークの構造や構成個体の特徴を表すための指標について概説し、それらをRで算出する方法を学ぶ。指標を算出することで定量的な分析が可能になり、<strong>グラフを見るだけでは定性的にしか言えなかったことを示すことができる</strong>ようになる。</p>
<p>本稿では主に<code>ANTs</code>パッケージ、または<code>sna</code>パッケージで指標の算出を行う。各指標についての説明は <span class="citation">鈴木 (<a href="#ref-Suzuki2017" role="doc-biblioref">2017</a>)</span> や <span class="citation">Sosa et al. (<a href="#ref-Sosa2020" role="doc-biblioref">2020</a>)</span> 、 <span class="citation">Farine &amp; Whitehead (<a href="#ref-Farine2015" role="doc-biblioref">2015</a>)</span> なども参照。</p>
<div id="ノードについての諸指標中心性指標" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> ノードについての諸指標(中心性指標)<a href="c3.html#ノードについての諸指標中心性指標" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>ここでは、各ノードのネットワーク内での特性を表す指標についてまとめる。中心性指標は、いずれも<strong>あるノードがそのグラフでどのくらい「中心的」であるかを表す指標</strong>である。以下で見るように、中心性を評価する方法は数多く提案されている。</p>
<p>基本的には、いずれも<code>ANTs</code>パッケージの<code>met.*()</code>関数で出力できる(*には中心性指標の名前)。これらの関数は、各ノードについて算出した中心性を各ノードの属性データ(例えば年齢や順位など)を記したデータフレームに追加していってくれるので、分析を行う際に非常に便利である。</p>
<p><u>属性データの例(年齢と順位)</u></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="c3.html#cb22-1" aria-hidden="true" tabindex="-1"></a>attr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;D&quot;</span>,<span class="st">&quot;E&quot;</span>,<span class="st">&quot;F&quot;</span>,<span class="st">&quot;G&quot;</span>,<span class="st">&quot;H&quot;</span>),</span>
<span id="cb22-2"><a href="c3.html#cb22-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">12</span>,<span class="dv">11</span>,<span class="dv">14</span>,<span class="dv">15</span>,<span class="dv">18</span>,<span class="dv">9</span>),</span>
<span id="cb22-3"><a href="c3.html#cb22-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rank =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">8</span>,<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">6</span>))</span>
<span id="cb22-4"><a href="c3.html#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="c3.html#cb22-5" aria-hidden="true" tabindex="-1"></a>attr <span class="sc">%&gt;%</span> </span>
<span id="cb22-6"><a href="c3.html#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">rownames =</span> <span class="cn">FALSE</span>, <span class="at">width =</span> <span class="st">&quot;55%&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-285d9fdbeb84f713ef15" style="width:55%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-285d9fdbeb84f713ef15">{"x":{"filter":"none","vertical":false,"data":[["A","B","C","D","E","F","G","H"],[12,13,12,11,14,15,18,9],[2,3,4,1,8,1,7,6]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>name<\/th>\n      <th>age<\/th>\n      <th>rank<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><br/></p>
<div id="次数中心性degree-centrality" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> 次数中心性(Degree centrality)<a href="c3.html#次数中心性degree-centrality" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>最も簡便で適用範囲の広い中心性が<strong>次数中心性</strong>である<span class="citation">(<a href="#ref-Suzuki2017" role="doc-biblioref">鈴木, 2017</a>)</span>。重みなしグラフについて算出でき、各ノードに辺で接続しているノードの数を、そのノードの次数中心性とする。例えば、図<a href="c3.html#fig:fig-degree">3.1</a>では、Aの次数中心性は5、Dの次数中心性は3である。</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-degree"></span>
<img src="Network_Analysis_Using_R_files/figure-html/fig-degree-1.png" alt="次数中心性算出のための無向グラフの例" width="336" />
<p class="caption">
図3.1: 次数中心性算出のための無向グラフの例
</p>
</div>
<p><br/></p>
<p><code>ANTs</code>パッケージでは、<code>met.degree</code>で求められる。以下のように<code>df =</code>に属性が入ったデータフレームを指定することで、算出した次数中心性をそのデータフレームに追加してくれる。</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="c3.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">met.degree</span>(mat_undir, </span>
<span id="cb23-2"><a href="c3.html#cb23-2" aria-hidden="true" tabindex="-1"></a>           <span class="do">## 属性データフレーム</span></span>
<span id="cb23-3"><a href="c3.html#cb23-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">df =</span> attr,</span>
<span id="cb23-4"><a href="c3.html#cb23-4" aria-hidden="true" tabindex="-1"></a>           <span class="do">## 個体IDの列番号</span></span>
<span id="cb23-5"><a href="c3.html#cb23-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">dfid =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-6"><a href="c3.html#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-7"><a href="c3.html#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">12</span>, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<table class="table" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
name
</th>
<th style="text-align:center;">
age
</th>
<th style="text-align:center;">
rank
</th>
<th style="text-align:center;">
degree
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
A
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
5
</td>
</tr>
<tr>
<td style="text-align:center;">
B
</td>
<td style="text-align:center;">
13
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
3
</td>
</tr>
<tr>
<td style="text-align:center;">
C
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
2
</td>
</tr>
<tr>
<td style="text-align:center;">
D
</td>
<td style="text-align:center;">
11
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
3
</td>
</tr>
<tr>
<td style="text-align:center;">
E
</td>
<td style="text-align:center;">
14
</td>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
3
</td>
</tr>
<tr>
<td style="text-align:center;">
F
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2
</td>
</tr>
<tr>
<td style="text-align:center;">
G
</td>
<td style="text-align:center;">
18
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
1
</td>
</tr>
<tr>
<td style="text-align:center;">
H
</td>
<td style="text-align:center;">
9
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
1
</td>
</tr>
</tbody>
</table>
<p><br/></p>
<p>有向グラフでは、他のノードから入ってくる辺の数である入次数(<strong>indegree</strong>)と他のノードへ入っていく辺の数である出次数(<strong>outdegree</strong>)が区別される。図<a href="c3.html#fig:fig-degree2">3.2</a>では、Aの入次数は2、出次数は3である。</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-degree2"></span>
<img src="Network_Analysis_Using_R_files/figure-html/fig-degree2-1.png" alt="次数中心性算出のための有向グラフの例" width="432" />
<p class="caption">
図3.2: 次数中心性算出のための有向グラフの例
</p>
</div>
<p><br/></p>
<p><code>ANTs</code>パッケージでは、それぞれ<code>met.indegree()</code>と<code>met.outdegree()</code>で求められる。</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="c3.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">## このようにすれば、2つの中心性指標を共に属性データに結合できる。</span></span>
<span id="cb24-2"><a href="c3.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">met.indegree</span>(mat_dir, </span>
<span id="cb24-3"><a href="c3.html#cb24-3" aria-hidden="true" tabindex="-1"></a>           <span class="do">## 属性データフレーム</span></span>
<span id="cb24-4"><a href="c3.html#cb24-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">df =</span> attr,</span>
<span id="cb24-5"><a href="c3.html#cb24-5" aria-hidden="true" tabindex="-1"></a>           <span class="do">## 個体IDの列番号</span></span>
<span id="cb24-6"><a href="c3.html#cb24-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">dfid =</span> <span class="dv">1</span>) <span class="ot">-&gt;</span> attr_b</span>
<span id="cb24-7"><a href="c3.html#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="c3.html#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">met.outdegree</span>(mat_dir, </span>
<span id="cb24-9"><a href="c3.html#cb24-9" aria-hidden="true" tabindex="-1"></a>           <span class="do">## 属性データフレーム(入次数の情報も含む)</span></span>
<span id="cb24-10"><a href="c3.html#cb24-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">df =</span> attr_b,</span>
<span id="cb24-11"><a href="c3.html#cb24-11" aria-hidden="true" tabindex="-1"></a>           <span class="do">## 個体IDの列番号</span></span>
<span id="cb24-12"><a href="c3.html#cb24-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">dfid =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-13"><a href="c3.html#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-14"><a href="c3.html#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">12</span>, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<table class="table" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
name
</th>
<th style="text-align:center;">
age
</th>
<th style="text-align:center;">
rank
</th>
<th style="text-align:center;">
indegree
</th>
<th style="text-align:center;">
outdegree
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
A
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
3
</td>
</tr>
<tr>
<td style="text-align:center;">
B
</td>
<td style="text-align:center;">
13
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
1
</td>
</tr>
<tr>
<td style="text-align:center;">
C
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2
</td>
</tr>
<tr>
<td style="text-align:center;">
D
</td>
<td style="text-align:center;">
11
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2
</td>
</tr>
<tr>
<td style="text-align:center;">
E
</td>
<td style="text-align:center;">
14
</td>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:center;">
F
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
1
</td>
</tr>
<tr>
<td style="text-align:center;">
G
</td>
<td style="text-align:center;">
18
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
3
</td>
</tr>
<tr>
<td style="text-align:center;">
H
</td>
<td style="text-align:center;">
9
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
</tr>
</tbody>
</table>
<p><br/></p>
</div>
<div id="重み付き中心性strength-centrality" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> 重み付き中心性(Strength centrality)<a href="c3.html#重み付き中心性strength-centrality" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>重み付き中心性</strong>は、各ノードに接続している辺の重みの合計で表される中心性である。図<a href="c3.html#fig:fig-strength">3.3</a>は表<a href="c3.html#tab:tab-strength">3.1</a>の隣接行列(<code>mat_undir_b</code>)のグラフである。グラフの辺上の数字は重みを表す。このとき、Aの重み付き中心性は<span class="math inline">\(3 + 2+ 2+ 1 +1=9\)</span>、Cの重み付き中心性は<span class="math inline">\(3 + 2 = 5\)</span>である。</p>
<table class="table" style="font-size: 10px; width: auto !important; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:tab-strength">表3.1: </span>隣接行列(mat_undir_b)
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
A
</th>
<th style="text-align:center;">
B
</th>
<th style="text-align:center;">
C
</th>
<th style="text-align:center;">
D
</th>
<th style="text-align:center;">
E
</th>
<th style="text-align:center;">
F
</th>
<th style="text-align:center;">
G
</th>
<th style="text-align:center;">
H
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
E
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
G
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
H
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
</tbody>
</table>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-strength"></span>
<img src="Network_Analysis_Using_R_files/figure-html/fig-strength-1.png" alt="重み付き中心性算出のための無向グラフの例" width="576" />
<p class="caption">
図3.3: 重み付き中心性算出のための無向グラフの例
</p>
</div>
<p><br/></p>
<p><code>ANTs</code>パッケージでは、<code>met.strength()</code>で求められる。まお、<code>ANTs</code>パッケージでは常に有向グラフとして計算されてしまうようなので、1/2してあげる必要がある。</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="c3.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">met.strength</span>(mat_undir_b<span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb25-2"><a href="c3.html#cb25-2" aria-hidden="true" tabindex="-1"></a>           <span class="do">## 属性データフレーム</span></span>
<span id="cb25-3"><a href="c3.html#cb25-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">df =</span> attr,</span>
<span id="cb25-4"><a href="c3.html#cb25-4" aria-hidden="true" tabindex="-1"></a>           <span class="do">## 個体IDの列番号</span></span>
<span id="cb25-5"><a href="c3.html#cb25-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">dfid =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-6"><a href="c3.html#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-7"><a href="c3.html#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">12</span>, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<table class="table" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
name
</th>
<th style="text-align:center;">
age
</th>
<th style="text-align:center;">
rank
</th>
<th style="text-align:center;">
strength
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
A
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
9
</td>
</tr>
<tr>
<td style="text-align:center;">
B
</td>
<td style="text-align:center;">
13
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
5
</td>
</tr>
<tr>
<td style="text-align:center;">
C
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
5
</td>
</tr>
<tr>
<td style="text-align:center;">
D
</td>
<td style="text-align:center;">
11
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
5
</td>
</tr>
<tr>
<td style="text-align:center;">
E
</td>
<td style="text-align:center;">
14
</td>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
7
</td>
</tr>
<tr>
<td style="text-align:center;">
F
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
3
</td>
</tr>
<tr>
<td style="text-align:center;">
G
</td>
<td style="text-align:center;">
18
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
1
</td>
</tr>
<tr>
<td style="text-align:center;">
H
</td>
<td style="text-align:center;">
9
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
1
</td>
</tr>
</tbody>
</table>
<p><br/></p>
<p>なお、有向データについては次数中心性と同じように<strong>instrength</strong>と<strong>outstrength</strong>で区別することもできる。その場合は、それぞれ<code>ANTs</code>パッケージの<code>met.indegree()</code>と<code>met.outstrength()</code>で算出できる。<br />
<br/></p>
<p><strong>おまけ</strong><br />
<code>sna</code>パッケージでは、次数中心性と重み付き中心性を全て<code>degree()</code>関数で求められる。</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="c3.html#cb26-1" aria-hidden="true" tabindex="-1"></a>sna<span class="sc">::</span><span class="fu">degree</span>(mat_undir_b,</span>
<span id="cb26-2"><a href="c3.html#cb26-2" aria-hidden="true" tabindex="-1"></a>       <span class="do">## 重みなしの場合 TRUE</span></span>
<span id="cb26-3"><a href="c3.html#cb26-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">ignore.eval =</span> <span class="cn">FALSE</span>,</span>
<span id="cb26-4"><a href="c3.html#cb26-4" aria-hidden="true" tabindex="-1"></a>       <span class="do">## 有向グラフの場合は &quot;digraph&quot;,</span></span>
<span id="cb26-5"><a href="c3.html#cb26-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">gmode =</span> <span class="st">&quot;graph&quot;</span>,</span>
<span id="cb26-6"><a href="c3.html#cb26-6" aria-hidden="true" tabindex="-1"></a>       <span class="do">## indegreeの場合は &quot;indegree&quot;、outdegreeの場合は&quot;outdegree&quot;,</span></span>
<span id="cb26-7"><a href="c3.html#cb26-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">cmode =</span> <span class="st">&quot;freeman&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 9 5 5 5 7 3 1 1</code></pre>
</div>
<div id="固有ベクトル中心性eigenvector-centrality" class="section level3 hasAnchor" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> 固有ベクトル中心性(Eigenvector centrality)<a href="c3.html#固有ベクトル中心性eigenvector-centrality" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>次数中心性や重み付け中心性は、あるノードに接続する辺の数や重みの合計に基づく中心性指標であった。つまり、例えば毛づくろい頻度ネットワークでは、多くの個体と毛づくろいしている個体や、毛づくろい頻度の合計が多い個体の中心性が高く評価される。しかし、この方法は中心性を評価する指標として適切ではない場合がある。例えば、毛づくろいを通してある行動がネットワーク内をどのように伝播するかを考えるとき、<u>毛づくろい相手の多い個体と毛づくろいすることは、毛づくろい相手の少ない個体と毛づくろいするよりも高く評価するべきかもしれない</u>。</p>
<p>このことを考慮するためは、あるノードの中心性を評価するときに、そのノードと繋がっているノードの中心性の大きさを反映させる必要がある。例えば、あるノードの中心性がそれとつながるノードの中心性の和に比例する方法が考えられる。このとき、ある無向グラフの隣接行列を<span class="math inline">\(A = (a_{ij})\)</span>とし、そこに含まれるノードの中心性を成分とする列ベクトルを<span class="math inline">\(c=c_i\)</span>とすると、ノード<span class="math inline">\(i\)</span>の中心性<span class="math inline">\(c_i\)</span>は次のように表現できる。ただし、<span class="math inline">\(\lambda\)</span>は正の比例定数である。</p>
<p><span class="math display">\[
\begin{aligned}
  c_i &amp;= \frac{1}{\lambda} \sum_{j=1}^{n} a_{ij}c_j
\end{aligned}
\]</span></p>
<p>行列とベクトルで表すと、以下のように書ける。<br />
<span class="math display">\[
\begin{aligned}
  c &amp;= \frac{1}{\lambda} Ac\\
  \therefore \lambda c &amp;= Ac
\end{aligned}
\]</span></p>
<p><br/></p>
<p>例えば、4個体について以下の隣接行列<span class="math inline">\(A\)</span>と中心性を成分とするベクトル<span class="math inline">\(c\)</span>を考える。</p>
<p>$$</p>
<span class="math display">\[\begin{aligned}
  &amp;A = (a_{ij}) =
  \begin{pmatrix}
  0 &amp; 1 &amp; 0 &amp; 0\\
  1 &amp; 0 &amp; 1 &amp; 1\\
  0 &amp; 1 &amp; 0 &amp; 1\\
  0 &amp; 1 &amp; 1 &amp; 0\\
  \end{pmatrix}\\
  \\
  
  &amp;c = \begin{pmatrix}
                    c_1\\
                    c_2\\
                    c_3\\
                    c_4
       \end{pmatrix}
\end{aligned}\]</span>
<p>$$</p>
<p><br/></p>
<p>このとき、以下のような式を満たす<span class="math inline">\(c\)</span>と<span class="math inline">\(\lambda\)</span>を求めることになる。</p>
$$<br />
<span class="math display">\[\begin{aligned}

  \lambda
  \begin{pmatrix}c_1\\
                          c_2\\
                          c_3\\
                          c_4
       \end{pmatrix} &amp;=
       
  \begin{pmatrix}
  0 &amp; 1 &amp; 0 &amp; 0\\
  1 &amp; 0 &amp; 1 &amp; 1\\
  0 &amp; 1 &amp; 0 &amp; 1\\
  0 &amp; 1 &amp; 1 &amp; 0
  \end{pmatrix}
  
  \begin{pmatrix}
  c_1\\
  c_2\\
  c_3\\
  c_4\\
  \end{pmatrix}\\
  
  \\
  
  \therefore \lambda
  \begin{pmatrix}
    c_1\\
    c_2\\
    c_3\\
    c_4\\
       \end{pmatrix} &amp;=
  \begin{pmatrix}
  c_2\\
  c_1 +c_3+ c_4\\
  c_2+c_4\\
  c_2+c_3\\
  \end{pmatrix}

\end{aligned}\]</span>
<p>$$</p>
<p><br/></p>
<p>ここで、これを満たす<span class="math inline">\(\lambda\)</span>は正方行列<span class="math inline">\(A\)</span>の<strong>固有値</strong>、<span class="math inline">\(c\)</span>は<strong>固有ベクトル</strong>になる<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>。つまり、隣接行列の固有ベクトルを求めれば、隣接するノードの中心性を反映した中心性を求めることができる(なお、固有値と固有ベクトルの組み合わせは<span class="math inline">\(A\)</span>の列数と同じだけある)。特に絶対値が最大となる固有値に対応する第1固有ベクトルを中心性指標としたものを、<strong>固有ベクトル中心性(eigenvector centrality)という</strong>。</p>
<p>あるノードの固有ベクトル中心性は、そのノードにつながるノードの中心性を反映しているが、それらのノードは更にそれらにつながるノードの中心性を反映している。このように、<strong>固有ベクトル中心性は、そのノードから辺をたどって到達できるすべてのノードの中心性を反映</strong>している。</p>
<p>先ほどの例の<span class="math inline">\(A\)</span>の第1固有ベクトルは以下のように求められる。固有ベクトルは負の値をとることもあるため、絶対値をとることが多い。また、最大値を1とした比で表すことも多い。</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="c3.html#cb28-1" aria-hidden="true" tabindex="-1"></a>A <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb28-2"><a href="c3.html#cb28-2" aria-hidden="true" tabindex="-1"></a>             <span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,</span>
<span id="cb28-3"><a href="c3.html#cb28-3" aria-hidden="true" tabindex="-1"></a>             <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,</span>
<span id="cb28-4"><a href="c3.html#cb28-4" aria-hidden="true" tabindex="-1"></a>             <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb28-5"><a href="c3.html#cb28-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-6"><a href="c3.html#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="c3.html#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 第1固有ベクトル。絶対値をとる。    </span></span>
<span id="cb28-8"><a href="c3.html#cb28-8" aria-hidden="true" tabindex="-1"></a>evc <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">eigen</span>(A)<span class="sc">$</span>vectors[,<span class="dv">1</span>])</span>
<span id="cb28-9"><a href="c3.html#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="c3.html#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 最大値を1とするようにする</span></span>
<span id="cb28-11"><a href="c3.html#cb28-11" aria-hidden="true" tabindex="-1"></a>evc<span class="sc">/</span><span class="fu">max</span>(evc)</span></code></pre></div>
<pre><code>## [1] 0.4608111 1.0000000 0.8546377 0.8546377</code></pre>
<p><br/></p>
<p><code>ANTs</code>パッケージでは<code>met.eigen()</code>関数で、<code>sna</code>パッケージでは<code>evcent()</code>関数で固有ベクトル中心性を求められる。前者は最大が1になるように変形しているのに対し、後者はそのような変形はしていない(定数倍しただけなので、分析上はどちらでも構わない)。</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="c3.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ANTs</span></span>
<span id="cb30-2"><a href="c3.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">met.eigen</span>(A)</span></code></pre></div>
<pre><code>## [1] 0.4608111 1.0000000 0.8546377 0.8546377</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="c3.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">## sna</span></span>
<span id="cb32-2"><a href="c3.html#cb32-2" aria-hidden="true" tabindex="-1"></a>sna<span class="sc">::</span><span class="fu">evcent</span>(A)</span></code></pre></div>
<pre><code>## [1] 0.2818452 0.6116285 0.5227207 0.5227207</code></pre>
<p><br/></p>
<p>以上は重みなしグラフについて算出を行ったが、重み付きグラフについても同様に算出できる。<br />
隣接行列<code>mat_undir_b</code>(表<a href="c3.html#tab:tab-strength">3.1</a>)ついて、それぞれ重み付き中心性(左)と固有ベクトル中心性(右)の値をノードの大きさに反映させたグラフが図<a href="c3.html#fig:fig-eigen">3.4</a>である。</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="c3.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb34-2"><a href="c3.html#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="c3.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 重み付き中心性の算出</span></span>
<span id="cb34-4"><a href="c3.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">met.strength</span>(mat_undir_b<span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb34-5"><a href="c3.html#cb34-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">df =</span> attr,</span>
<span id="cb34-6"><a href="c3.html#cb34-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">dfid =</span> <span class="dv">1</span>) <span class="ot">-&gt;</span> attr_st</span>
<span id="cb34-7"><a href="c3.html#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="c3.html#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 固有ベクトル中心性の算出</span></span>
<span id="cb34-9"><a href="c3.html#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="fu">met.eigen</span>(mat_undir_b, </span>
<span id="cb34-10"><a href="c3.html#cb34-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">df =</span> attr_st,</span>
<span id="cb34-11"><a href="c3.html#cb34-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">dfid =</span> <span class="dv">1</span>) <span class="ot">-&gt;</span> attr_st_evc</span>
<span id="cb34-12"><a href="c3.html#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="c3.html#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 重み付き中心性のグラフ</span></span>
<span id="cb34-14"><a href="c3.html#cb34-14" aria-hidden="true" tabindex="-1"></a>mat_undir_b <span class="sc">%&gt;%</span> </span>
<span id="cb34-15"><a href="c3.html#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tbl_graph</span>(<span class="at">directed =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-16"><a href="c3.html#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="do">## `tbl_graph`に重み付き中心性の情報を追加</span></span>
<span id="cb34-17"><a href="c3.html#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">strength =</span> attr_st_evc<span class="sc">$</span>strength) <span class="sc">%&gt;%</span> </span>
<span id="cb34-18"><a href="c3.html#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>(<span class="at">layout =</span> <span class="st">&quot;nicely&quot;</span>)<span class="sc">+</span></span>
<span id="cb34-19"><a href="c3.html#cb34-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> strength), <span class="at">shape =</span> <span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb34-20"><a href="c3.html#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">13</span>))<span class="sc">+</span></span>
<span id="cb34-21"><a href="c3.html#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">width =</span> weight),<span class="at">color =</span> <span class="st">&quot;grey65&quot;</span>,</span>
<span id="cb34-22"><a href="c3.html#cb34-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">end_cap =</span> <span class="fu">circle</span>(<span class="fl">0.5</span>,<span class="st">&quot;cm&quot;</span>),</span>
<span id="cb34-23"><a href="c3.html#cb34-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start_cap =</span> <span class="fu">circle</span>(<span class="fl">0.5</span>,<span class="st">&quot;cm&quot;</span>))<span class="sc">+</span></span>
<span id="cb34-24"><a href="c3.html#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>)<span class="sc">+</span></span>
<span id="cb34-25"><a href="c3.html#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_width</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))<span class="sc">+</span></span>
<span id="cb34-26"><a href="c3.html#cb34-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;重み付き中心性&quot;</span>)<span class="sc">+</span></span>
<span id="cb34-27"><a href="c3.html#cb34-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="ot">-&gt;</span> p_strength</span>
<span id="cb34-28"><a href="c3.html#cb34-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-29"><a href="c3.html#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="do">## 固有ベクトル中心性のグラフ</span></span>
<span id="cb34-30"><a href="c3.html#cb34-30" aria-hidden="true" tabindex="-1"></a>mat_undir_b <span class="sc">%&gt;%</span> </span>
<span id="cb34-31"><a href="c3.html#cb34-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tbl_graph</span>(<span class="at">directed =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-32"><a href="c3.html#cb34-32" aria-hidden="true" tabindex="-1"></a>  <span class="do">## `tbl_graph`に固有ベクトル中心性の情報を追加</span></span>
<span id="cb34-33"><a href="c3.html#cb34-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">eigen =</span> attr_st_evc<span class="sc">$</span>eigen) <span class="sc">%&gt;%</span> </span>
<span id="cb34-34"><a href="c3.html#cb34-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>(<span class="at">layout =</span> <span class="st">&quot;nicely&quot;</span>)<span class="sc">+</span></span>
<span id="cb34-35"><a href="c3.html#cb34-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> eigen), <span class="at">shape =</span> <span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb34-36"><a href="c3.html#cb34-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">13</span>))<span class="sc">+</span></span>
<span id="cb34-37"><a href="c3.html#cb34-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">width =</span> weight),<span class="at">color =</span> <span class="st">&quot;grey65&quot;</span>,</span>
<span id="cb34-38"><a href="c3.html#cb34-38" aria-hidden="true" tabindex="-1"></a>                 <span class="at">end_cap =</span> <span class="fu">circle</span>(<span class="fl">0.5</span>,<span class="st">&quot;cm&quot;</span>),</span>
<span id="cb34-39"><a href="c3.html#cb34-39" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start_cap =</span> <span class="fu">circle</span>(<span class="fl">0.5</span>,<span class="st">&quot;cm&quot;</span>))<span class="sc">+</span></span>
<span id="cb34-40"><a href="c3.html#cb34-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>)<span class="sc">+</span></span>
<span id="cb34-41"><a href="c3.html#cb34-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_width</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))<span class="sc">+</span></span>
<span id="cb34-42"><a href="c3.html#cb34-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;固有ベクトル中心性&quot;</span>)<span class="sc">+</span></span>
<span id="cb34-43"><a href="c3.html#cb34-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="ot">-&gt;</span> p_eigen</span>
<span id="cb34-44"><a href="c3.html#cb34-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-45"><a href="c3.html#cb34-45" aria-hidden="true" tabindex="-1"></a>p_strength <span class="sc">+</span> p_eigen</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-eigen"></span>
<img src="Network_Analysis_Using_R_files/figure-html/fig-eigen-1.png" alt="重み付き中心性(左)と固有ベクトル中心性(右)の値をノードの大きさに反映させたグラフ" width="864" />
<p class="caption">
図3.4: 重み付き中心性(左)と固有ベクトル中心性(右)の値をノードの大きさに反映させたグラフ
</p>
</div>
<p><br/></p>
</div>
<div id="pagerank" class="section level3 hasAnchor" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> PageRank<a href="c3.html#pagerank" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>固有ベクトル中心性は、分離したグラフや有向グラフの中心性分析には使えない。<strong>PageRankは</strong>固有ベクトルに基づきながら、これらのグラフにも適用できる中心性指標である。もともとはウェブページの評価法として、Google創業者であるラリー・ペイジとセルゲイ・ブリンらによって開発され<span class="citation">(<a href="#ref-Page1999" role="doc-biblioref">Page et al., 1999</a>)</span>、他ページからのリンクが多いページほどランキングが高く、ランキングの高いページからのリンクや、他のページへのリンクが少ないページからのリンクを高く評価するというアルゴリズムに従う。詳細な算出方法は複雑なので、ここでは説明しない。詳しくは <span class="citation">鈴木 (<a href="#ref-Suzuki2017" role="doc-biblioref">2017</a>)</span> を参照。</p>
<p>PageRankは<code>igraph</code>パッケージを用いて算出できる。表<a href="c3.html#tab:tab-pagerank">3.2</a>の隣接行列(<code>mat_dir_b</code>)のPageRankを算出する。</p>
<table class="table" style="font-size: 10px; width: auto !important; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:tab-pagerank">表3.2: </span>隣接行列(mat_dir_b)
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
A
</th>
<th style="text-align:center;">
B
</th>
<th style="text-align:center;">
C
</th>
<th style="text-align:center;">
D
</th>
<th style="text-align:center;">
E
</th>
<th style="text-align:center;">
F
</th>
<th style="text-align:center;">
G
</th>
<th style="text-align:center;">
H
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
E
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
G
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
H
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
</tbody>
</table>
<p><br/></p>
<p><code>igraph</code>パッケージでデータを扱う際には、まず隣接行列を<code>igraph</code>クラスにしなくてはならない。<code>graph_from_adjacency_matrix()</code>関数で<code>igraph</code>クラスに変換した後、<code>page.rank()</code>関数でPageRankを算出する。</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="c3.html#cb35-1" aria-hidden="true" tabindex="-1"></a>mat_dir <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="c3.html#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 隣接行列をgraphに変換</span></span>
<span id="cb35-3"><a href="c3.html#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">graph_from_adjacency_matrix</span>(<span class="at">weighted =</span> <span class="cn">NULL</span>, <span class="at">mode =</span> <span class="st">&quot;directed&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="c3.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## PageRankの算出  </span></span>
<span id="cb35-5"><a href="c3.html#cb35-5" aria-hidden="true" tabindex="-1"></a>  　<span class="fu">page.rank</span>(<span class="at">directed =</span> <span class="cn">TRUE</span>) <span class="ot">-&gt;</span> page_rank</span>
<span id="cb35-6"><a href="c3.html#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="c3.html#cb35-7" aria-hidden="true" tabindex="-1"></a>page_rank<span class="sc">$</span>vector</span></code></pre></div>
<pre><code>##          A          B          C          D          E          F          G 
## 0.12584798 0.18619542 0.14217932 0.07093242 0.06542177 0.12576921 0.19354160 
##          H 
## 0.09011228</code></pre>
<p>PageRankの値をノードの大きさに反映したグラフが図<a href="c3.html#fig:fig-pagerank">3.5</a>である。</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="c3.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb37-2"><a href="c3.html#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="c3.html#cb37-3" aria-hidden="true" tabindex="-1"></a>mat_dir_b <span class="sc">%&gt;%</span> </span>
<span id="cb37-4"><a href="c3.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tbl_graph</span>(<span class="at">directed =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-5"><a href="c3.html#cb37-5" aria-hidden="true" tabindex="-1"></a>   <span class="do">## `tbl_graph`にPageRankの情報を追加</span></span>
<span id="cb37-6"><a href="c3.html#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PageRank =</span> page_rank<span class="sc">$</span>vector) <span class="sc">%&gt;%</span> </span>
<span id="cb37-7"><a href="c3.html#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>(<span class="at">layout =</span> <span class="st">&quot;nicely&quot;</span>)<span class="sc">+</span></span>
<span id="cb37-8"><a href="c3.html#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> PageRank),<span class="at">shape =</span> <span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb37-9"><a href="c3.html#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">13</span>))<span class="sc">+</span></span>
<span id="cb37-10"><a href="c3.html#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_fan</span>(<span class="fu">aes</span>(<span class="at">width =</span> weight),</span>
<span id="cb37-11"><a href="c3.html#cb37-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;grey65&quot;</span>,</span>
<span id="cb37-12"><a href="c3.html#cb37-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">angle =</span> <span class="dv">30</span>, <span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">4</span>,<span class="at">units =</span> <span class="st">&quot;mm&quot;</span>), <span class="at">type =</span> <span class="st">&quot;closed&quot;</span>),</span>
<span id="cb37-13"><a href="c3.html#cb37-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">end_cap =</span> <span class="fu">circle</span>(<span class="fl">0.5</span>,<span class="st">&quot;cm&quot;</span>),</span>
<span id="cb37-14"><a href="c3.html#cb37-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start_cap =</span> <span class="fu">circle</span>(<span class="fl">0.5</span>,<span class="st">&quot;cm&quot;</span>))<span class="sc">+</span></span>
<span id="cb37-15"><a href="c3.html#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>)<span class="sc">+</span></span>
<span id="cb37-16"><a href="c3.html#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_width</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb37-17"><a href="c3.html#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;PageRank&quot;</span>)<span class="sc">+</span></span>
<span id="cb37-18"><a href="c3.html#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>()<span class="sc">+</span></span>
<span id="cb37-19"><a href="c3.html#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.05</span>))<span class="sc">+</span></span>
<span id="cb37-20"><a href="c3.html#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.05</span>))<span class="ot">-&gt;</span> p_pr</span>
<span id="cb37-21"><a href="c3.html#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="c3.html#cb37-22" aria-hidden="true" tabindex="-1"></a>p_pr</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-pagerank"></span>
<img src="Network_Analysis_Using_R_files/figure-html/fig-pagerank-1.png" alt="PageRankの値をノードの大きさに反映させたグラフ" width="480" />
<p class="caption">
図3.5: PageRankの値をノードの大きさに反映させたグラフ
</p>
</div>
<p><br/></p>
</div>
<div id="媒介中心性betweeness-centrality" class="section level3 hasAnchor" number="3.1.5">
<h3><span class="header-section-number">3.1.5</span> 媒介中心性(Betweeness centrality)<a href="c3.html#媒介中心性betweeness-centrality" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ネットワークにおける媒介や伝達に着目した中心性に<strong>媒介中心性</strong>がある。媒介中心性は、<u>他のノード同士をつなぐ最短経路上に位置するノード</u>は、ノード間の仲介や情報の伝達に与える影響が大きいという点で有力であり、より多くのノード間の最短経路上にあるノードほどその影響力が大きいとする指標である。</p>
<p>ノード<span class="math inline">\(i\)</span>の媒介中心性は以下の式で定式化される。なお、<span class="math inline">\(g_{jk}\)</span>はノード<span class="math inline">\(j\)</span>と<span class="math inline">\(k\)</span>の間の最短経路数であり、<span class="math inline">\(g_{ij}(i)\)</span>はノード<span class="math inline">\(j\)</span>と<span class="math inline">\(k\)</span>の間の最短経路のうちノード<span class="math inline">\(i\)</span>を通るものの数である。無向グラフの場合、<span class="math inline">\(j &lt; k\)</span>である。</p>
<p><span class="math display">\[
C_b(i) = \sum_{i \neq j \neq k} \frac {g_{jk}(i)}{g_{jk}}
\]</span>
<br/></p>
<p><code>ANTs</code>パッケージでは<code>met.betweeness()</code>関数で、<code>sna</code>パッケージでは<code>sna::betweeness()</code>関数で媒介中心性を求められる。表<a href="c3.html#tab:tab-pagerank">3.2</a>の隣接行列(<code>mat_dir_b</code>)について算出すると、以下のようになる。</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="c3.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ANTs</span></span>
<span id="cb38-2"><a href="c3.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">met.betweenness</span>(mat_dir_b,</span>
<span id="cb38-3"><a href="c3.html#cb38-3" aria-hidden="true" tabindex="-1"></a>                <span class="do">## 重みなしならTRUE</span></span>
<span id="cb38-4"><a href="c3.html#cb38-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">binary =</span> <span class="cn">FALSE</span>,</span>
<span id="cb38-5"><a href="c3.html#cb38-5" aria-hidden="true" tabindex="-1"></a>                <span class="do">## 無向グラフならTRUE</span></span>
<span id="cb38-6"><a href="c3.html#cb38-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">sym =</span> <span class="cn">FALSE</span>,</span>
<span id="cb38-7"><a href="c3.html#cb38-7" aria-hidden="true" tabindex="-1"></a>                <span class="do">## 最もstrengthが重みの合計が高い経路を最短とする</span></span>
<span id="cb38-8"><a href="c3.html#cb38-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">shortest.weight =</span> <span class="cn">TRUE</span>,</span>
<span id="cb38-9"><a href="c3.html#cb38-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">df =</span> attr,</span>
<span id="cb38-10"><a href="c3.html#cb38-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">dfid =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-11"><a href="c3.html#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-12"><a href="c3.html#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">12</span>, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<table class="table" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
name
</th>
<th style="text-align:center;">
age
</th>
<th style="text-align:center;">
rank
</th>
<th style="text-align:center;">
norm.short.outbetweenness
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
A
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
22.0
</td>
</tr>
<tr>
<td style="text-align:center;">
B
</td>
<td style="text-align:center;">
13
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
13.5
</td>
</tr>
<tr>
<td style="text-align:center;">
C
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
1.0
</td>
</tr>
<tr>
<td style="text-align:center;">
D
</td>
<td style="text-align:center;">
11
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
8.5
</td>
</tr>
<tr>
<td style="text-align:center;">
E
</td>
<td style="text-align:center;">
14
</td>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
2.5
</td>
</tr>
<tr>
<td style="text-align:center;">
F
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
15.0
</td>
</tr>
<tr>
<td style="text-align:center;">
G
</td>
<td style="text-align:center;">
18
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
5.5
</td>
</tr>
<tr>
<td style="text-align:center;">
H
</td>
<td style="text-align:center;">
9
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
5.5
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="c3.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="do">## sna</span></span>
<span id="cb39-2"><a href="c3.html#cb39-2" aria-hidden="true" tabindex="-1"></a>sna<span class="sc">::</span><span class="fu">betweenness</span>(mat_dir_b, </span>
<span id="cb39-3"><a href="c3.html#cb39-3" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## 無向グラフなら&quot;undirected&quot;</span></span>
<span id="cb39-4"><a href="c3.html#cb39-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">cmode =</span> <span class="st">&quot;directed&quot;</span>,</span>
<span id="cb39-5"><a href="c3.html#cb39-5" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## 重みなしならTRUE</span></span>
<span id="cb39-6"><a href="c3.html#cb39-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ignore.eval =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] 22.0 13.5  1.0  8.5  2.5 15.0  5.5  5.5</code></pre>
媒介中心性の値をノードの大きさに反映したグラフが図<a href="c3.html#fig:fig-between">3.6</a>である。
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-between"></span>
<img src="Network_Analysis_Using_R_files/figure-html/fig-between-1.png" alt="媒介中心性の値をノードの大きさに反映させたグラフ" width="480" />
<p class="caption">
図3.6: 媒介中心性の値をノードの大きさに反映させたグラフ
</p>
</div>
</div>
<div id="情報中心性information-centrality" class="section level3 hasAnchor" number="3.1.6">
<h3><span class="header-section-number">3.1.6</span> 情報中心性(Information centrality)<a href="c3.html#情報中心性information-centrality" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>媒介中心性は最短経路以外の経路や、経路の長さを考慮していなかった。しかし、実際の情報の伝達は最短経路のみでなされるとは限らないし、情報伝達に関わる人が多いほど情報の精度が下がるような可能性もある。そこで、ノード間の最短経路以外の経路や経路の長さを考慮した指標として、<strong>情報中心性</strong>が考案された。</p>
<p>情報中心性の算出では、経路が短いほど高く評価されるように経路の長さの逆数で重みづけされる。例えば、図<a href="c3.html#fig:fig-info-exam">3.7</a>のノード<span class="math inline">\(2\)</span>と<span class="math inline">\(4\)</span>について考える。これらのノードの間の経路には<span class="math inline">\(2-1-4\)</span>と<span class="math inline">\(2-3-1-4\)</span>の2通りがあり、それぞれの長さは2と3である。ただし、2つの経路には<span class="math inline">\(1-4\)</span>という共通の経路が存在する。</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-info-exam"></span>
<img src="Network_Analysis_Using_R_files/figure-html/fig-info-exam-1.png" alt="情報中心性算出のための無向グラフの例" width="336" />
<p class="caption">
図3.7: 情報中心性算出のための無向グラフの例
</p>
</div>
<p><br/></p>
<p>このとき、ノード<span class="math inline">\(2\)</span>と<span class="math inline">\(4\)</span>について以下の行列<span class="math inline">\(D_{24}\)</span>を考える。なお、行列の対角成分にはそれぞれの経路の長さが、それ以外の成分には2つの経路で共通する辺の数が入る。</p>
<p><span class="math inline">\(D_{24} = \begin{pmatrix} 2 &amp; 1 \\1 &amp; 3\end{pmatrix}\)</span></p>
<p>そして、この行列の逆行列<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a><span class="math inline">\(D_{24}^{-1}\)</span>の各行の成分の合計を、各経路の<strong>情報量</strong>とする。この場合、<span class="math inline">\(0.6-0.2 = 0.4\)</span>が経路<span class="math inline">\(2-1-4\)</span>の、<span class="math inline">\(-0.2 + 0.4 = 0.2\)</span>が経路<span class="math inline">\(2-3-1-4\)</span>の情報量である。また、その和(<span class="math inline">\(0.4+0.2=0.6\)</span>)をノード<span class="math inline">\(2\)</span>と<span class="math inline">\(4\)</span>のペアについての<strong>情報量</strong>(<span class="math inline">\(I_{24}\)</span>)とする。このように全てのノードペアについての情報量を算出する(自身との情報量は<span class="math inline">\(I_{ii} = \infty\)</span>である)。</p>
<p><span class="math inline">\(D_{24}^{-1} = \begin{pmatrix} 0.6 &amp; -0.2 \\ -0.2 &amp; 0.4 \end{pmatrix}\)</span></p>
<p>このとき、各ノード<span class="math inline">\(i\)</span>の情報中心性(<span class="math inline">\(C_{inf}(i)\)</span>)は、<strong>ノード</strong><span class="math inline">\(i\)</span><strong>が含まれるノードペアの情報量の調和平均</strong><a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>になる。数式では以下のように書ける。ただし、<span class="math inline">\(n\)</span>は全ノードの数である。</p>
<p><span class="math inline">\(C_{inf}(i) = \frac{n}{\sum_{j=1}^n 1/I_{ij}}\)</span></p>
<p><br/></p>
<p>情報中心性は<code>sna</code>パッケージの<code>infocent()</code>関数で求められる。表<a href="c3.html#tab:tab-pagerank">3.2</a>の隣接行列(<code>mat_dir_b</code>)について算出すると、以下のようになる。</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="c3.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">infocent</span>(mat_dir_b,</span>
<span id="cb41-2"><a href="c3.html#cb41-2" aria-hidden="true" tabindex="-1"></a>         <span class="do">##無向グラフなら &quot;graph&quot;</span></span>
<span id="cb41-3"><a href="c3.html#cb41-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">gmode =</span> <span class="st">&quot;digraph&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 1.881874 1.408537 1.157895 1.439252 1.483146 1.714286 1.200000 1.168142</code></pre>
<p><br/></p>
<p>情報中心性の値をノードの大きさに反映したグラフを、それぞれPageRankと媒介中心性の値をノードの大きさに反映した2つのグラフと並べたものがが図<a href="c3.html#fig:fig-info">3.8</a>である。</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-info"></span>
<img src="Network_Analysis_Using_R_files/figure-html/fig-info-1.png" alt="PageRank・媒介中心性・情報中心性の値をノードの大きさに反映させたグラフ" width="1200" />
<p class="caption">
図3.8: PageRank・媒介中心性・情報中心性の値をノードの大きさに反映させたグラフ
</p>
</div>
</div>
</div>
<div id="ネットワーク構造の諸指標" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> ネットワーク構造の諸指標<a href="c3.html#ネットワーク構造の諸指標" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>ここでは、ネットワーク全体の構造の特徴を表す指標についてまとめる。</p>
<div id="集中度centralization" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> 集中度(Centralization)<a href="c3.html#集中度centralization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>前節では、各ノードがグラフ内でどの程度中心的かを表す指標として中心性指標を扱ってきた。それらを用いて<u>グラフにおいて特定のノードに高い中心性がどの程度集中しているのか</u>を示す指標が<strong>集中度</strong>である。グラフの集中度(<span class="math inline">\(C_x\)</span>)は以下の式によって定式化され、0から1の値をとる。ただし、各ノードの中心性指標を<span class="math inline">\(C_x(i)\)</span>、グラフにおけるその中心性指標の最大値を<span class="math inline">\(C_x(i^*)\)</span>とする。また、そのグラフと同数のノード(n個)を持つグラフにおける<span class="math inline">\(\sum_{i=1}^n [C_x(i^*)-C_x(i)]\)</span>の最大値を<span class="math inline">\(max\sum_{i=1}^n [C_x(i^*)-C_x(i)]\)</span>とする。</p>
<p><span class="math inline">\(C_x = \frac {\sum_{i=1}^n [C_x(i^*)-C_x(i)]}{max\sum_{i=1}^n [C_x(i^*)-C_x(i)]}\)</span></p>
<p>例として、第<a href="c2.html#c2">2</a>章で算出した毛づくろい頻度ネットワーク<code>groom_mat_b</code>(表<a href="c2.html#tab:tab-groom-b">2.3</a>)の集中度を求める。<code>igraph</code>パッケージでは、様々な中心性指標についての中心度を求められる。<code>graph_from_adjacency_matrix()</code>で<code>igraph</code>クラスに変換した後に算出する。</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="c3.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="do">## igraphクラスに変換</span></span>
<span id="cb43-2"><a href="c3.html#cb43-2" aria-hidden="true" tabindex="-1"></a>graph_groom <span class="ot">&lt;-</span> <span class="fu">graph_from_adjacency_matrix</span>(groom_mat_b,</span>
<span id="cb43-3"><a href="c3.html#cb43-3" aria-hidden="true" tabindex="-1"></a>                                           <span class="do">## 有向グラフなら &quot;directed&quot;</span></span>
<span id="cb43-4"><a href="c3.html#cb43-4" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">mode=</span> <span class="st">&quot;undirected&quot;</span>, </span>
<span id="cb43-5"><a href="c3.html#cb43-5" aria-hidden="true" tabindex="-1"></a>                                           <span class="do">## 重みなしなら NULL</span></span>
<span id="cb43-6"><a href="c3.html#cb43-6" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">weighted =</span> <span class="cn">TRUE</span>) </span>
<span id="cb43-7"><a href="c3.html#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="c3.html#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="c3.html#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 次数中心性  </span></span>
<span id="cb43-10"><a href="c3.html#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="fu">centr_degree</span>(graph_groom,</span>
<span id="cb43-11"><a href="c3.html#cb43-11" aria-hidden="true" tabindex="-1"></a>             <span class="do">## 入次数、出次数ならそれぞれ &quot;in&quot;と&quot;out</span></span>
<span id="cb43-12"><a href="c3.html#cb43-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">mode =</span> <span class="st">&quot;all&quot;</span>)<span class="sc">$</span>centralization <span class="ot">-&gt;</span> cent_deg</span>
<span id="cb43-13"><a href="c3.html#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="c3.html#cb43-14" aria-hidden="true" tabindex="-1"></a>cent_deg</span></code></pre></div>
<pre><code>## [1] 0.2904412</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="c3.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 固有ベクトル中心性  </span></span>
<span id="cb45-2"><a href="c3.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">centr_eigen</span>(graph_groom,</span>
<span id="cb45-3"><a href="c3.html#cb45-3" aria-hidden="true" tabindex="-1"></a>            <span class="do">## 有向グラフならTRUE</span></span>
<span id="cb45-4"><a href="c3.html#cb45-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">directed =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>centralization <span class="ot">-&gt;</span> cent_eig</span>
<span id="cb45-5"><a href="c3.html#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="c3.html#cb45-6" aria-hidden="true" tabindex="-1"></a>cent_eig</span></code></pre></div>
<pre><code>## [1] 0.3104138</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="c3.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 媒介中心性  </span></span>
<span id="cb47-2"><a href="c3.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">centr_betw</span>(graph_groom,</span>
<span id="cb47-3"><a href="c3.html#cb47-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">directed =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>centralization <span class="ot">-&gt;</span> cent_bet</span>
<span id="cb47-4"><a href="c3.html#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="c3.html#cb47-5" aria-hidden="true" tabindex="-1"></a>cent_bet</span></code></pre></div>
<pre><code>## [1] 0.04678902</code></pre>
各指標の大きさをノードサイズに反映したグラフを以下に示した(図<a href="c3.html#fig:fig-centr">3.9</a>)。集中度はそこまで高くないといえそう(特に媒介中心性は)?
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-centr"></span>
<img src="Network_Analysis_Using_R_files/figure-html/fig-centr-1.png" alt="次数中心性・固有ベクトル中心性・媒介中心性の値をノードの大きさに反映したグラフと各指標における集中度。
 ノードが赤い個体が各指標の最も大きい個体を示す" width="1248" />
<p class="caption">
図3.9: 次数中心性・固有ベクトル中心性・媒介中心性の値をノードの大きさに反映したグラフと各指標における集中度。
ノードが赤い個体が各指標の最も大きい個体を示す
</p>
</div>
</div>
<div id="密度density" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> 密度(Density)<a href="c3.html#密度density" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>密度は、社会ネットワークにおける関係の緊密さの指標になりうる。密度が低いとき、社会ネットワーク内の個体間の直接的な関係は少なく、両者の関係は媒介者を通じた間接的なものが多いということができる<span class="citation">(<a href="#ref-Croft2019" role="doc-biblioref">Croft et al., 2008</a>)</span>。</p>
<ul>
<li><p>重み無しグラフの場合: 実際の辺の数をグラフに張ることが可能な辺の最大数で割ったもの<br />
ノードの数を<span class="math inline">\(n\)</span>、実際の辺の数を<span class="math inline">\(m\)</span>としたとき、<span class="math inline">\(2m/n(n-1)\)</span>(無向グラフ)または<span class="math inline">\(m/n(n-1)\)</span>(有向グラフ)</p></li>
<li><p>重み付きグラフの場合: 全辺の重みの合計をグラフに張ることが可能な辺の最大数で割ったもの<br />
ノードの数を<span class="math inline">\(n\)</span>、重みの合計を<span class="math inline">\(w\)</span>としたとき、<span class="math inline">\(2w/n(n-1)\)</span>(無向グラフ)または<span class="math inline">\(2m/n(n-1)\)</span>(有向グラフ)</p></li>
</ul>
<p>ここでは、表<a href="c3.html#tab:tab-strength">3.1</a>の隣接行列を用いて密度を算出する。<br />
<code>ANTs</code>パッケージでは、<code>met.density()</code>で計算可能。ただし、重みなしグラフとして算出されるよう。また、<code>list()</code>関数で複数の隣接行列をリスト化することで、同時に2つ以上の隣接行列について密度を算出できる。</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="c3.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">met.density</span>(mat_undir_b)</span></code></pre></div>
<pre><code>##   Density 
## 0.3571429</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="c3.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="do">## リスト化</span></span>
<span id="cb51-2"><a href="c3.html#cb51-2" aria-hidden="true" tabindex="-1"></a>list_mat <span class="ot">&lt;-</span> <span class="fu">list</span>(mat_undir_b, mat_dir_b)</span>
<span id="cb51-3"><a href="c3.html#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="c3.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">met.density</span>(list_mat)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 0.3571429
## 
## [[2]]
## [1] 0.2678571</code></pre>
<p><code>sna</code>パッケージでは、<code>gden()</code>で計算可能。<code>ignore.value = FALSE</code>とすると重み付きグラフとして扱われる。<code>ANTs</code>パッケージと同様、リスト化した複数の隣接行列の密度を同時に算出できる。</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="c3.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 重み付き</span></span>
<span id="cb53-2"><a href="c3.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gden</span>(mat_undir_b, </span>
<span id="cb53-3"><a href="c3.html#cb53-3" aria-hidden="true" tabindex="-1"></a>     <span class="do">## 重み無グラフならば、TRUE</span></span>
<span id="cb53-4"><a href="c3.html#cb53-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ignore.eval =</span> <span class="cn">FALSE</span>,</span>
<span id="cb53-5"><a href="c3.html#cb53-5" aria-hidden="true" tabindex="-1"></a>     <span class="do">## 有向グラフならば &quot;digraph&quot;</span></span>
<span id="cb53-6"><a href="c3.html#cb53-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">mode =</span> <span class="st">&quot;graph&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0.6428571</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="c3.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="do">## リスト化</span></span>
<span id="cb55-2"><a href="c3.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gden</span>(list_mat)</span></code></pre></div>
<pre><code>## [1] 0.6428571 0.4464286</code></pre>
</div>
<div id="同類性assortativity" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> 同類性(Assortativity)<a href="c3.html#同類性assortativity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ネットワーク内において、<u>似ているノード同士が結びつきやすい/結びつきにくいか</u>を表したのが<strong>同類性</strong>である。ネットワーク内の辺の両端にあるノードの中心性指標や属性の相関係数を算出したものであり、-1から1の値をとる(重み付きグラフの場合は、それで重み付けされているよう)。<u>各ノードの離散的な属性(性別、順位カテゴリなど)と連続的な属性(中心性指標、年齢など)のいずれにも適用できる</u>。計算方法の詳細は <span class="citation">Farine (<a href="#ref-Farine2014" role="doc-biblioref">2014</a>)</span> を参照。</p>
<p>ここでは例として、再び毛づくろい頻度ネットワーク<code>groom_mat_b</code>(表<a href="c2.html#tab:tab-groom-b">2.3</a>)を使用する。同類性は<code>assortnet</code>パッケージ<span class="citation">(<a href="#ref-Farine2014" role="doc-biblioref">Farine, 2014</a>)</span>の関数群を用いて算出できる。</p>
<div id="連続的な属性の場合" class="section level4 hasAnchor" number="3.2.3.1">
<h4><span class="header-section-number">3.2.3.1</span> 連続的な属性の場合<a href="c3.html#連続的な属性の場合" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>年齢が近い個体同士が結びつきやすいかを調べる。連続的な属性の同類性は<code>assortment.continuous()</code>関数で算出できる。係数は-0.397…となり、<strong>年齢の近い個体同士は結びつきにくい</strong>という結果になった。</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="c3.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 年齢(2019年時点)</span></span>
<span id="cb57-2"><a href="c3.html#cb57-2" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> age <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">13</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">11</span>,<span class="dv">15</span>,<span class="dv">8</span>,<span class="dv">13</span>,<span class="dv">9</span>,<span class="dv">7</span>,<span class="dv">18</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">16</span>,<span class="dv">11</span>,<span class="dv">14</span>,<span class="dv">11</span>,<span class="dv">11</span>)</span>
<span id="cb57-3"><a href="c3.html#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="c3.html#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 同類性</span></span>
<span id="cb57-5"><a href="c3.html#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">assortment.continuous</span>(groom_mat_b,</span>
<span id="cb57-6"><a href="c3.html#cb57-6" aria-hidden="true" tabindex="-1"></a>                      <span class="do">## 各ノードの属性</span></span>
<span id="cb57-7"><a href="c3.html#cb57-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">vertex_values =</span> age,</span>
<span id="cb57-8"><a href="c3.html#cb57-8" aria-hidden="true" tabindex="-1"></a>                      <span class="do">## 重みなしなら FALSE</span></span>
<span id="cb57-9"><a href="c3.html#cb57-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">weighted =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## $r
## [1] -0.397096</code></pre>
</div>
<div id="離散的な属性の場合" class="section level4 hasAnchor" number="3.2.3.2">
<h4><span class="header-section-number">3.2.3.2</span> 離散的な属性の場合<a href="c3.html#離散的な属性の場合" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>同じ年齢カテゴリ(低順位: m、中順位: m、高順位: h)の個体同士が結びつきやすいかを調べる。離散的な属性の同類性は<code>assortment.discrete()</code>関数で算出できる。係数はかなり高く(0.484…)、<strong>同順位カテゴリ―の個体同士がよく結びつく傾向</strong>がある。</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="c3.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 順位カテゴリ</span></span>
<span id="cb59-2"><a href="c3.html#cb59-2" aria-hidden="true" tabindex="-1"></a>rank <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">&quot;m&quot;</span>,<span class="st">&quot;m&quot;</span>,<span class="st">&quot;l&quot;</span>,<span class="st">&quot;l&quot;</span>,<span class="st">&quot;h&quot;</span>,<span class="st">&quot;h&quot;</span>,<span class="st">&quot;h&quot;</span>,<span class="st">&quot;h&quot;</span>,<span class="st">&quot;h&quot;</span>,<span class="st">&quot;h&quot;</span>,<span class="st">&quot;l&quot;</span>,<span class="st">&quot;l&quot;</span>,<span class="st">&quot;l&quot;</span>,<span class="st">&quot;m&quot;</span>,<span class="st">&quot;m&quot;</span>,<span class="st">&quot;m&quot;</span>,<span class="st">&quot;m&quot;</span>)</span>
<span id="cb59-3"><a href="c3.html#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="c3.html#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 同類性</span></span>
<span id="cb59-5"><a href="c3.html#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">assortment.discrete</span>(groom_mat_b,</span>
<span id="cb59-6"><a href="c3.html#cb59-6" aria-hidden="true" tabindex="-1"></a>                  <span class="do">## 各ノードの属性</span></span>
<span id="cb59-7"><a href="c3.html#cb59-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">types =</span> rank,</span>
<span id="cb59-8"><a href="c3.html#cb59-8" aria-hidden="true" tabindex="-1"></a>                  <span class="do">## 重みなしなら FALSE</span></span>
<span id="cb59-9"><a href="c3.html#cb59-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">weighted =</span> <span class="cn">TRUE</span>) <span class="ot">-&gt;</span> assort_rank</span>
<span id="cb59-10"><a href="c3.html#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="c3.html#cb59-11" aria-hidden="true" tabindex="-1"></a>assort_rank<span class="sc">$</span>r</span></code></pre></div>
<pre><code>## [1] 0.4840036</code></pre>
<p>各カテゴリ間のノードのweightの合計を計算した隣接行列も出力してくれる(表<a href="c3.html#tab:tab-cor">3.3</a>)。この表からも、同順位カテゴリ間での交渉が多いことが分かる。</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="c3.html#cb61-1" aria-hidden="true" tabindex="-1"></a>assort_rank<span class="sc">$</span>mixing_matrix <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="c3.html#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>,<span class="at">caption =</span> <span class="st">&quot;各カテゴリ間のweightの合計&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="c3.html#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">12</span>, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<table class="table" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:tab-cor">表3.3: </span>各カテゴリ間のweightの合計
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
m
</th>
<th style="text-align:center;">
l
</th>
<th style="text-align:center;">
h
</th>
<th style="text-align:center;">
ai
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
m
</td>
<td style="text-align:center;">
0.25
</td>
<td style="text-align:center;">
0.08
</td>
<td style="text-align:center;">
0.06
</td>
<td style="text-align:center;">
0.40
</td>
</tr>
<tr>
<td style="text-align:left;">
l
</td>
<td style="text-align:center;">
0.08
</td>
<td style="text-align:center;">
0.13
</td>
<td style="text-align:center;">
0.02
</td>
<td style="text-align:center;">
0.23
</td>
</tr>
<tr>
<td style="text-align:left;">
h
</td>
<td style="text-align:center;">
0.06
</td>
<td style="text-align:center;">
0.02
</td>
<td style="text-align:center;">
0.28
</td>
<td style="text-align:center;">
0.36
</td>
</tr>
<tr>
<td style="text-align:left;">
bi
</td>
<td style="text-align:center;">
0.40
</td>
<td style="text-align:center;">
0.23
</td>
<td style="text-align:center;">
0.36
</td>
<td style="text-align:center;">
1.00
</td>
</tr>
</tbody>
</table>
<p><br/></p>
<p>なお離散的な属性については、<code>ANTs</code>パッケージの<code>met.assortativity()</code>関数を用いると、node label permutation(詳細は<a href="#s3-2"><strong>??</strong></a>)で生成したランダムなネットワークにおける同類性を指定した数だけ生成してくれる。<u>それらの何%より実際の同類性の数値が大きい/小さいかを検討することで、統計的な検定が行える</u>。今回の例では、実測値はランダムな値の全てより小さいので、ランダムな場合より<u>有意に小さいと言える</u>(図<a href="c3.html#fig:fig-perm">3.10</a>)。</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="c3.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="do">## node label permutationで生成したランダムなネットワーク100個についてassortativityを算出</span></span>
<span id="cb62-2"><a href="c3.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">met.assortativity</span>(groom_mat_b,</span>
<span id="cb62-3"><a href="c3.html#cb62-3" aria-hidden="true" tabindex="-1"></a>                  <span class="do">## 各ノードの固有ベクトル中心性  </span></span>
<span id="cb62-4"><a href="c3.html#cb62-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">attr =</span> rank,</span>
<span id="cb62-5"><a href="c3.html#cb62-5" aria-hidden="true" tabindex="-1"></a>                  <span class="do">## 重みなしの場合 FALSE</span></span>
<span id="cb62-6"><a href="c3.html#cb62-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">weighted =</span> <span class="cn">TRUE</span>,</span>
<span id="cb62-7"><a href="c3.html#cb62-7" aria-hidden="true" tabindex="-1"></a>                  <span class="do">## node label permutationをするか</span></span>
<span id="cb62-8"><a href="c3.html#cb62-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">perm.nl =</span> <span class="cn">TRUE</span>,</span>
<span id="cb62-9"><a href="c3.html#cb62-9" aria-hidden="true" tabindex="-1"></a>                  <span class="do">## permutationの数</span></span>
<span id="cb62-10"><a href="c3.html#cb62-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nperm =</span> <span class="dv">10000</span>) <span class="ot">-&gt;</span> nlperm_rank</span>
<span id="cb62-11"><a href="c3.html#cb62-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-12"><a href="c3.html#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="do">### ランダムなassortativityの何%より小さい？</span></span>
<span id="cb62-13"><a href="c3.html#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(nlperm_rank <span class="sc">&gt;</span> assort_rank<span class="sc">$</span>r)<span class="sc">/</span><span class="dv">10000</span></span></code></pre></div>
<pre><code>## [1] 1e-04</code></pre>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-perm"></span>
<img src="Network_Analysis_Using_R_files/figure-html/fig-perm-1.png" alt="ランダムなネットワークの同類性の分布(灰色)と実測値(赤)" width="384" />
<p class="caption">
図3.10: ランダムなネットワークの同類性の分布(灰色)と実測値(赤)
</p>
</div>
</div>
</div>
<div id="推移性transitivity" class="section level3 hasAnchor" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> 推移性(Transitivity)<a href="c3.html#推移性transitivity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ネットワークにおいて、頂点<span class="math inline">\(i\)</span>と<span class="math inline">\(j\)</span>の間、および頂点<span class="math inline">\(j\)</span>と<span class="math inline">\(k\)</span>の間に関係があり、頂点<span class="math inline">\(i\)</span>と<span class="math inline">\(k\)</span>の間にも関係があるとき、関係が<strong>推移的</strong>であるという。例えば、図<a href="c3.html#fig:fig-trans">3.11</a>で頂点A, B, Cの関係は推移的だが、頂点A, B, Gは推移的ではない。</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-trans"></span>
<img src="Network_Analysis_Using_R_files/figure-html/fig-trans-1.png" alt="推移性の説明のための無向グラフの例" width="384" />
<p class="caption">
図3.11: 推移性の説明のための無向グラフの例
</p>
</div>
有向グラフの場合は、頂点<span class="math inline">\(i\)</span>から<span class="math inline">\(j\)</span>、頂点<span class="math inline">\(j\)</span>から<span class="math inline">\(k\)</span>に有向辺があり、かつ頂点<span class="math inline">\(i\)</span>から<span class="math inline">\(k\)</span>に有向辺があるとき推移的であるという(図<a href="c3.html#fig:fig-trans2">3.12</a>)。<br />
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-trans2"></span>
<img src="Network_Analysis_Using_R_files/figure-html/fig-trans2-1.png" alt="推移性の説明のための有向グラフの例" width="220.8" />
<p class="caption">
図3.12: 推移性の説明のための有向グラフの例
</p>
</div>
<p><strong>推移性</strong>はネットワーク内で推移的な関係が成り立っている比率を指す。例えば無向グラフの場合には、頂点<span class="math inline">\(i\)</span>と<span class="math inline">\(j\)</span>、<span class="math inline">\(j\)</span>と<span class="math inline">\(k\)</span>の間に辺があるとき、頂点<span class="math inline">\(i\)</span>と<span class="math inline">\(k\)</span>にも辺がある割合である。推移性はネットワークがどの程度クラスター化されているかの指標になる<span class="citation">(<a href="#ref-Farine2015" role="doc-biblioref">Farine &amp; Whitehead, 2015</a>)</span>。そのため、<strong>クラスター係数</strong>と呼ばれることもある。</p>
<p>例として、毛づくろい頻度ネットワーク<code>groom_mat_b</code>(表<a href="c2.html#tab:tab-groom-b">2.3</a>)の推移性を算出する。推移性は<code>igraph</code>パッケージの<code>transitivity()</code>関数で求められる。推移性は高い？</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="c3.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">transitivity</span>(graph_groom,</span>
<span id="cb64-2"><a href="c3.html#cb64-2" aria-hidden="true" tabindex="-1"></a>             <span class="do">## 有向グラフなら &quot;directed&quot;</span></span>
<span id="cb64-3"><a href="c3.html#cb64-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">type =</span> <span class="st">&quot;undirected&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0.6909722</code></pre>
</div>
<div id="modularity" class="section level3 hasAnchor" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Modularity<a href="c3.html#modularity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>霊長類のネットワークの種間比較でよく用いられる指標にNewmanの<strong>modularity</strong><span class="citation">(<a href="#ref-Newman2004" role="doc-biblioref">Newman, 2004</a>; <a href="#ref-Whitehead2008" role="doc-biblioref">Whitehead, 2008</a>)</span>がある。この指標は、<u>ネットワーク内を複数のクラスターに分けたとき、クラスター内の個体間での交渉がクラスター間の個体間の交渉よりどの程度多いか</u>を示したもので、0から1の値をとる。値が高い(1に近い)ほどその差が大きいことを示し、クラスターの分け方が妥当であることを示す。<span class="citation">Newman (<a href="#ref-Newman2004" role="doc-biblioref">2004</a>)</span> は、modularityが0.3以上のとき、クラスター間がよく分断されているとしている。例えばマカクの種間比較研究では、血縁ごとにクラスター分けしたとき、寛容性が低い種は高い種よりもmodularityが高い(0.33±0.08 vs 0.21 ±0.03)、つまり交渉がより血縁に偏っていることが分かっている<span class="citation">(<a href="#ref-Sueur2011b" role="doc-biblioref">Sueur, Petit, et al., 2011</a>)</span>。</p>
<p>Modularityは以下のように定式化される<span class="citation">(<a href="#ref-Csardi2006" role="doc-biblioref">Csardi et al., 2006</a>)</span>。</p>
<p><span class="math inline">\(Q = \frac{1}{2m} \sum_{i,j} (A_{ij} - \gamma \frac{k_i k_j}{2m}) \delta(c_i,c_j)\)</span><br />
<br/></p>
<p>なお、<span class="math inline">\(m\)</span>は辺の数、<span class="math inline">\(A_{ij}\)</span>は隣接行列の<span class="math inline">\(i\)</span>行目<span class="math inline">\(j\)</span>列目の成分、<span class="math inline">\(k_i\)</span>と<span class="math inline">\(k_j\)</span>はノード<span class="math inline">\(i\)</span>と<span class="math inline">\(j\)</span>の重み付き中心性を表す(<span class="math inline">\(k_i\)</span>と<span class="math inline">\(k_j\)</span>に固有ベクトル中心性を使っている論文もある<span class="citation">(<a href="#ref-Bala2018" role="doc-biblioref">Balasubramaniam et al., 2018</a>)</span>)。また、<span class="math inline">\(\delta(c_i,c_j)\)</span>はノード<span class="math inline">\(i\)</span>と<span class="math inline">\(j\)</span>が同じクラスターに属しているときは1、そうでないときは0になる。なお、<span class="math inline">\(\gamma \frac{k_i k_j}{2m}\)</span>の部分は、ランダムに交渉が行割れていると仮定したときの<span class="math inline">\(A_{ij}\)</span>の値である。<span class="math inline">\(\delta\)</span>はデフォルトでは1だが変化させることができ、大きい値をとるほどクラスター数が多くなる。</p>
<p>ここでは例として、毛づくろい頻度ネットワーク<code>groom_mat_b</code>(表<a href="c2.html#tab:tab-groom-b">2.3</a>)を用いて、各順位カテゴリ内(低順位・中順位・高順位)の交渉がカテゴリ間の交渉よりどの程度多いかを、<span class="math inline">\(Q\)</span>を算出することで求める。</p>
<p>Rでは、<code>igraph</code>パッケージの<code>modularity()</code>関数で求めることができる。<code>graph_from_adjacency_matrix()</code>で<code>igraph</code>クラスに変換した後に算出する。また、<code>weight =</code>で明示的に各エッジのweightを与えてあげる必要があるよう。modularityは0.315…とそこそこ大きい値であるので、順位カテゴリ内に毛づくろいが偏っていることを示している。</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="c3.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 順位カテゴリごとに番号を振る</span></span>
<span id="cb66-2"><a href="c3.html#cb66-2" aria-hidden="true" tabindex="-1"></a>rank <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb66-3"><a href="c3.html#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="c3.html#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="do">## igraphに変換</span></span>
<span id="cb66-5"><a href="c3.html#cb66-5" aria-hidden="true" tabindex="-1"></a>graph_groom <span class="ot">&lt;-</span> <span class="fu">graph_from_adjacency_matrix</span>(groom_mat_b,</span>
<span id="cb66-6"><a href="c3.html#cb66-6" aria-hidden="true" tabindex="-1"></a>                                           <span class="do">## 有向グラフなら &quot;directed&quot;</span></span>
<span id="cb66-7"><a href="c3.html#cb66-7" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">mode=</span> <span class="st">&quot;undirected&quot;</span>, </span>
<span id="cb66-8"><a href="c3.html#cb66-8" aria-hidden="true" tabindex="-1"></a>                                           <span class="do">## 重みなしなら NULL</span></span>
<span id="cb66-9"><a href="c3.html#cb66-9" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">weighted =</span> <span class="cn">TRUE</span>) </span>
<span id="cb66-10"><a href="c3.html#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="c3.html#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="c3.html#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="fu">modularity</span>(graph_groom,</span>
<span id="cb66-13"><a href="c3.html#cb66-13" aria-hidden="true" tabindex="-1"></a>           <span class="do">## クラスターの分け方</span></span>
<span id="cb66-14"><a href="c3.html#cb66-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">membership =</span> rank,</span>
<span id="cb66-15"><a href="c3.html#cb66-15" aria-hidden="true" tabindex="-1"></a>           <span class="do">## deltaの値</span></span>
<span id="cb66-16"><a href="c3.html#cb66-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">resolution =</span> <span class="dv">1</span>,</span>
<span id="cb66-17"><a href="c3.html#cb66-17" aria-hidden="true" tabindex="-1"></a>           <span class="do">## 有向グラフなら TRUE</span></span>
<span id="cb66-18"><a href="c3.html#cb66-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">directed =</span> <span class="cn">FALSE</span>,</span>
<span id="cb66-19"><a href="c3.html#cb66-19" aria-hidden="true" tabindex="-1"></a>           <span class="do">## グラフのweightを与える</span></span>
<span id="cb66-20"><a href="c3.html#cb66-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">weights =</span> <span class="fu">E</span>(graph_groom, <span class="at">directed =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>weight)</span></code></pre></div>
<pre><code>## [1] 0.3152957</code></pre>
</div>
<div id="応用例下位集団の検出" class="section level3 hasAnchor" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> 応用例(下位集団の検出)<a href="c3.html#応用例下位集団の検出" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ネットワーク内に下位集団(クラスター)が存在するかを調べる方法はたくさんあるが<span class="citation">(詳細は <a href="#ref-Suzuki2017" role="doc-biblioref">鈴木, 2017</a>)</span>、ここでは主に2つの方法に焦点を当てて紹介する。</p>
<div id="modularityを用いる方法" class="section level4 hasAnchor" number="3.2.6.1">
<h4><span class="header-section-number">3.2.6.1</span> Modularityを用いる方法<a href="c3.html#modularityを用いる方法" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>一つの方法として<u>modularityが最大になるような分け方</u>がある。<code>igraph</code>パッケージでは、<code>cluster_optimal()</code>でそのようなクラスタの分け方を算出してくれる。なお、ノード数が多い場合には時間がかかるため、様々な近似計算法が考案されている(<code>cluster_fast_greedy()</code>、<code>cluster_walktrap()</code>など)。</p>
<p>例として、毛づくろい頻度ネットワーク<code>groom_mat_b</code>(表<a href="c2.html#tab:tab-groom-b">2.3</a>)について算出する。その結果、4つのクラスターに分類され、そのときのmodularityは0.40だった。概ね順位ごとに分かれていることが分かる(同じアルファベットから始まる個体が同一家系である)。高順位、中順位(2つに分かれている)、低順位にほぼ綺麗に分かれた。</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="c3.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 算出</span></span>
<span id="cb68-2"><a href="c3.html#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cluster_optimal</span>(graph_groom,</span>
<span id="cb68-3"><a href="c3.html#cb68-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">weights =</span> <span class="fu">E</span>(graph_groom)<span class="sc">$</span>weight) <span class="ot">-&gt;</span> cluster_groom</span>
<span id="cb68-4"><a href="c3.html#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="c3.html#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 結果</span></span>
<span id="cb68-6"><a href="c3.html#cb68-6" aria-hidden="true" tabindex="-1"></a>cluster_groom</span></code></pre></div>
<pre><code>## IGRAPH clustering optimal, groups: 4, mod: 0.4
## + groups:
##   $`1`
##   [1] &quot;Aka&quot; &quot;Ako&quot; &quot;Mei&quot;
##   
##   $`2`
##   [1] &quot;Hen&quot; &quot;Hot&quot; &quot;Mal&quot; &quot;Mik&quot; &quot;Tam&quot; &quot;Tot&quot;
##   
##   $`3`
##   [1] &quot;Kil&quot; &quot;Kit&quot; &quot;Koh&quot; &quot;Kor&quot; &quot;Kun&quot; &quot;Kur&quot;
##   
##   $`4`
##   + ... omitted several groups/vertices</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="c3.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="do">## modularity</span></span>
<span id="cb70-2"><a href="c3.html#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">modularity</span>(cluster_groom,<span class="at">directed =</span> <span class="cn">FALSE</span>, <span class="at">weights =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<pre><code>## [1] 0.4020546</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="c3.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 確認   </span></span>
<span id="cb72-2"><a href="c3.html#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">modularity</span>(graph_groom,</span>
<span id="cb72-3"><a href="c3.html#cb72-3" aria-hidden="true" tabindex="-1"></a>           <span class="do">## クラスターの分け方</span></span>
<span id="cb72-4"><a href="c3.html#cb72-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">membership =</span> <span class="fu">membership</span>(cluster_groom),</span>
<span id="cb72-5"><a href="c3.html#cb72-5" aria-hidden="true" tabindex="-1"></a>           <span class="do">## deltaの値</span></span>
<span id="cb72-6"><a href="c3.html#cb72-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">resolution =</span> <span class="dv">1</span>,</span>
<span id="cb72-7"><a href="c3.html#cb72-7" aria-hidden="true" tabindex="-1"></a>           <span class="do">## 有向グラフなら TRUE</span></span>
<span id="cb72-8"><a href="c3.html#cb72-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">directed =</span> <span class="cn">FALSE</span>,</span>
<span id="cb72-9"><a href="c3.html#cb72-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">weights =</span> <span class="fu">E</span>(graph_groom)<span class="sc">$</span>weight)                                                                       </span></code></pre></div>
<pre><code>## [1] 0.4020546</code></pre>
<p>クラスターごとに色分けして図示すると図<a href="c3.html#fig:fig-cluster">3.13</a>のようになる。</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="c3.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">125</span>)</span>
<span id="cb74-2"><a href="c3.html#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="c3.html#cb74-3" aria-hidden="true" tabindex="-1"></a>graph_groom <span class="sc">%&gt;%</span> </span>
<span id="cb74-4"><a href="c3.html#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tbl_graph</span>(<span class="at">directed =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-5"><a href="c3.html#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 各個体がどのクラスターに属するかを指定</span></span>
<span id="cb74-6"><a href="c3.html#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">member =</span> <span class="fu">as.factor</span>(cluster_groom<span class="sc">$</span>membership)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-7"><a href="c3.html#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>(<span class="at">layout =</span> <span class="st">&quot;nicely&quot;</span>)<span class="sc">+</span></span>
<span id="cb74-8"><a href="c3.html#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## クラスターごとに囲う</span></span>
<span id="cb74-9"><a href="c3.html#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_mark_hull</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y,<span class="at">fill =</span> member),</span>
<span id="cb74-10"><a href="c3.html#cb74-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">concavity =</span> <span class="dv">10</span>)<span class="sc">+</span></span>
<span id="cb74-11"><a href="c3.html#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> member),<span class="at">shape =</span> <span class="dv">16</span>, <span class="at">size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb74-12"><a href="c3.html#cb74-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="at">start_cap =</span> <span class="fu">circle</span>(<span class="fl">0.5</span>,<span class="st">&quot;cm&quot;</span>),</span>
<span id="cb74-13"><a href="c3.html#cb74-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">end_cap =</span> <span class="fu">circle</span>(<span class="fl">0.5</span>,<span class="st">&quot;cm&quot;</span>),</span>
<span id="cb74-14"><a href="c3.html#cb74-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;grey55&quot;</span>,</span>
<span id="cb74-15"><a href="c3.html#cb74-15" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">width =</span> weight))<span class="sc">+</span></span>
<span id="cb74-16"><a href="c3.html#cb74-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_width</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>))<span class="sc">+</span></span>
<span id="cb74-17"><a href="c3.html#cb74-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>)<span class="sc">+</span></span>
<span id="cb74-18"><a href="c3.html#cb74-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>()<span class="sc">+</span></span>
<span id="cb74-19"><a href="c3.html#cb74-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_nejm</span>()<span class="sc">+</span></span>
<span id="cb74-20"><a href="c3.html#cb74-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_nejm</span>()<span class="sc">+</span></span>
<span id="cb74-21"><a href="c3.html#cb74-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">0.9</span>)<span class="sc">+</span></span>
<span id="cb74-22"><a href="c3.html#cb74-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.12</span>,<span class="fl">0.12</span>))<span class="sc">+</span></span>
<span id="cb74-23"><a href="c3.html#cb74-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-cluster"></span>
<img src="Network_Analysis_Using_R_files/figure-html/fig-cluster-1.png" alt="Modularityに基づいてクラスターごとに色分けした毛づくろい頻度のグラフ" width="576" />
<p class="caption">
図3.13: Modularityに基づいてクラスターごとに色分けした毛づくろい頻度のグラフ
</p>
</div>
</div>
<div id="構造類似性を用いる方法" class="section level4 hasAnchor" number="3.2.6.2">
<h4><span class="header-section-number">3.2.6.2</span> 構造類似性を用いる方法<a href="c3.html#構造類似性を用いる方法" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>他の方法として、ノード間でネットワーク内での構造的な位置が類似している程度(= <strong>構造類似性</strong>)を用いる方法がある。構造類似性の指標として良く用いられるのが<strong>ユークリッド距離</strong>や<strong>相関係数</strong>である。このような構造類似性の指標を用い、ネットワーク上における位置の似た頂点をひとまとめにし、ネットワークをより少ないいくつかの<strong>ブロック</strong>同士の関係に分けることを<strong>ブロックモデリング</strong>という。</p>
<p><u><strong>ユークリッド距離</strong></u><br />
ノード<span class="math inline">\(i\)</span>と<span class="math inline">\(j\)</span>のユークリッド距離(<span class="math inline">\(d_{ij}\)</span>)は隣接行列<span class="math inline">\(A = (a_{ij})\)</span>について以下のように定式化される。<span class="math inline">\(d_{ij}\)</span>が大きいほど類似性は低い。</p>
<p><span class="math display">\[
d_{ij} = \sqrt {\sum_{k =1}^{n}(a_{ij}-a_{jk})^2 + (a_{ki}-a_{kj})^2 }
\]</span>
<u><strong>相関係数</strong></u><br />
ノード<span class="math inline">\(i\)</span>とノード<span class="math inline">\(j\)</span>の相関係数(<span class="math inline">\(r_{ij}\)</span>は隣接行列<span class="math inline">\(A = (a_{ij})\)</span>について以下のように定式化される。<span class="math inline">\(r_{ij}\)</span>が大きいほど類似性は高い。</p>
<p><span class="math display">\[
r_{ij} = \frac{(i列とj列の共分散) + (i行とj行の共分散)}{(i列とi行の標準偏差) \times (j列とj行の標準偏差)}
\]</span>
<br/></p>
<p><code>sna</code>パッケージの<code>equiv.clust()</code>関数を用いることで、構造同値性に基づいたクラスター分析ができる。ここでは、毛づくろい頻度ネットワーク<code>groom_mat_b</code>(表<a href="c2.html#tab:tab-groom-b">2.3</a>)のユークリッド距離を用いて分析を行う。<code>method =</code>で使用する構造類似性の指標を、<code>clust.method =</code>で階層クラスター分析の方法を指定する(方法の詳細は<a href="https://www.kamishima.net/jp/clustering/">こちら</a>) 。</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="c3.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ユークリッド距離</span></span>
<span id="cb75-2"><a href="c3.html#cb75-2" aria-hidden="true" tabindex="-1"></a>cluster_groom_euc <span class="ot">&lt;-</span> <span class="fu">equiv.clust</span>(groom_mat_b,</span>
<span id="cb75-3"><a href="c3.html#cb75-3" aria-hidden="true" tabindex="-1"></a>                            <span class="do">## 相関係数なら &quot;correlation&quot;</span></span>
<span id="cb75-4"><a href="c3.html#cb75-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">method =</span> <span class="st">&quot;euclidean&quot;</span>,</span>
<span id="cb75-5"><a href="c3.html#cb75-5" aria-hidden="true" tabindex="-1"></a>                            <span class="do">## 階層クラスター分析の方法</span></span>
<span id="cb75-6"><a href="c3.html#cb75-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">cluster.method =</span> <span class="st">&quot;complete&quot;</span>)</span></code></pre></div>
クラスター分析に基づくデンドログラムは図<a href="c3.html#fig:fig-dendro">3.14</a>のようになる。縦軸が互いのユークリッド距離を表す。<br />
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-dendro"></span>
<img src="Network_Analysis_Using_R_files/figure-html/fig-dendro-1.png" alt="クラスター分析結果に基づくデンドログラム" width="528" />
<p class="caption">
図3.14: クラスター分析結果に基づくデンドログラム
</p>
</div>
<p>この結果から<code>blockmodel()</code>関数でブロックモデルを作る。引数<code>h =</code>でクラスター(= ブロック)を作る基準となる高さを、もしくは引数<code>k =</code>でブロック数を指定できる。ここでは、ブロック数を3つに指定したときの結果を調べる。各個体がどのブロックに振り分けられたかは、表<a href="c3.html#tab:tab-cluster3">3.4</a>の通りである。</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="c3.html#cb76-1" aria-hidden="true" tabindex="-1"></a>blockmodel_groom_3 <span class="ot">&lt;-</span> <span class="fu">blockmodel</span>(<span class="do">## 隣接行列</span></span>
<span id="cb76-2"><a href="c3.html#cb76-2" aria-hidden="true" tabindex="-1"></a>                    groom_mat_b, </span>
<span id="cb76-3"><a href="c3.html#cb76-3" aria-hidden="true" tabindex="-1"></a>                    <span class="do">## クラスター分析結果</span></span>
<span id="cb76-4"><a href="c3.html#cb76-4" aria-hidden="true" tabindex="-1"></a>                    cluster_groom_euc, </span>
<span id="cb76-5"><a href="c3.html#cb76-5" aria-hidden="true" tabindex="-1"></a>                    <span class="do">## `k =`でクラスター数の指定。`h = `でクラスターの基準の高さも指定できる。</span></span>
<span id="cb76-6"><a href="c3.html#cb76-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">k =</span> <span class="dv">3</span>) </span>
<span id="cb76-7"><a href="c3.html#cb76-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-8"><a href="c3.html#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="do">## メンバーシップ</span></span>
<span id="cb76-9"><a href="c3.html#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">femaleID =</span> blockmodel_groom_3<span class="sc">$</span>plabels,</span>
<span id="cb76-10"><a href="c3.html#cb76-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">block =</span> blockmodel_groom_3<span class="sc">$</span>block.membership) <span class="sc">%&gt;%</span> </span>
<span id="cb76-11"><a href="c3.html#cb76-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(femaleID) <span class="ot">-&gt;</span> membership_3 </span>
<span id="cb76-12"><a href="c3.html#cb76-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-13"><a href="c3.html#cb76-13" aria-hidden="true" tabindex="-1"></a>membership_3 <span class="sc">%&gt;%</span> </span>
<span id="cb76-14"><a href="c3.html#cb76-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> femaleID, <span class="at">values_from =</span> block) <span class="sc">%&gt;%</span> </span>
<span id="cb76-15"><a href="c3.html#cb76-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>, <span class="at">caption =</span> <span class="st">&quot;ブロック数が3のときに各個体が属するブロック&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-16"><a href="c3.html#cb76-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">8</span>, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<table class="table" style="font-size: 8px; width: auto !important; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:tab-cluster3">表3.4: </span>ブロック数が3のときに各個体が属するブロック
</caption>
<thead>
<tr>
<th style="text-align:center;">
Aka
</th>
<th style="text-align:center;">
Ako
</th>
<th style="text-align:center;">
Hen
</th>
<th style="text-align:center;">
Hot
</th>
<th style="text-align:center;">
Kil
</th>
<th style="text-align:center;">
Kit
</th>
<th style="text-align:center;">
Koh
</th>
<th style="text-align:center;">
Kor
</th>
<th style="text-align:center;">
Kun
</th>
<th style="text-align:center;">
Kur
</th>
<th style="text-align:center;">
Mal
</th>
<th style="text-align:center;">
Mei
</th>
<th style="text-align:center;">
Mik
</th>
<th style="text-align:center;">
Ntr
</th>
<th style="text-align:center;">
Tam
</th>
<th style="text-align:center;">
Ten
</th>
<th style="text-align:center;">
Tot
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2
</td>
</tr>
</tbody>
</table>
<p><br/></p>
<p>ブロック数を2から5に変化させたときにmodularityがどうなるかを調べたところ、<code>k = 3</code>のときに最大になるよう(表<a href="c3.html#tab:tab-cluster-modularity">3.5</a>)。</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="c3.html#cb77-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">=</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb77-2"><a href="c3.html#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="c3.html#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="do">## kを2~5にしたときに各個体が属するブロックを計算</span></span>
<span id="cb77-4"><a href="c3.html#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(k, <span class="sc">~</span><span class="fu">blockmodel</span>(<span class="do">## 隣接行列</span></span>
<span id="cb77-5"><a href="c3.html#cb77-5" aria-hidden="true" tabindex="-1"></a>                    groom_mat_b, </span>
<span id="cb77-6"><a href="c3.html#cb77-6" aria-hidden="true" tabindex="-1"></a>                    <span class="do">## クラスター分析結果</span></span>
<span id="cb77-7"><a href="c3.html#cb77-7" aria-hidden="true" tabindex="-1"></a>                    cluster_groom_euc, </span>
<span id="cb77-8"><a href="c3.html#cb77-8" aria-hidden="true" tabindex="-1"></a>                    <span class="do">## `k =`でクラスター数の指定。`h = `でクラスターの基準の高さも指定できる。</span></span>
<span id="cb77-9"><a href="c3.html#cb77-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">k =</span> .)<span class="sc">$</span>block.membership) <span class="ot">-&gt;</span> member_list</span>
<span id="cb77-10"><a href="c3.html#cb77-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-11"><a href="c3.html#cb77-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-12"><a href="c3.html#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="do">## modularityを算出  </span></span>
<span id="cb77-13"><a href="c3.html#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">k =</span> <span class="fu">rep</span>(k,<span class="at">each =</span> <span class="dv">17</span>),<span class="at">femaleID =</span> blockmodel_groom_3<span class="sc">$</span>plabels,</span>
<span id="cb77-14"><a href="c3.html#cb77-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">member =</span> <span class="fu">c</span>(member_list[[<span class="dv">1</span>]],member_list[[<span class="dv">2</span>]],member_list[[<span class="dv">3</span>]],member_list[[<span class="dv">4</span>]])) <span class="sc">%&gt;%</span> </span>
<span id="cb77-15"><a href="c3.html#cb77-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(k) <span class="sc">%&gt;%</span> </span>
<span id="cb77-16"><a href="c3.html#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb77-17"><a href="c3.html#cb77-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">member2 =</span> <span class="fu">map</span>(data,<span class="sc">~</span><span class="fu">arrange</span>(., femaleID)<span class="sc">$</span>member)) <span class="sc">%&gt;%</span> </span>
<span id="cb77-18"><a href="c3.html#cb77-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(k, member2) <span class="sc">%&gt;%</span> </span>
<span id="cb77-19"><a href="c3.html#cb77-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(k) <span class="sc">%&gt;%</span> </span>
<span id="cb77-20"><a href="c3.html#cb77-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">modularity =</span> <span class="fu">map</span>(member2, <span class="sc">~</span><span class="fu">modularity</span>(graph_groom, <span class="at">membership =</span> <span class="fu">as.factor</span>(.),</span>
<span id="cb77-21"><a href="c3.html#cb77-21" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">weights =</span> <span class="fu">E</span>(graph_groom, <span class="at">directed =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>weight))) <span class="sc">%&gt;%</span> </span>
<span id="cb77-22"><a href="c3.html#cb77-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(k, modularity) <span class="sc">%&gt;%</span> </span>
<span id="cb77-23"><a href="c3.html#cb77-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(modularity)) <span class="sc">%&gt;%</span> </span>
<span id="cb77-24"><a href="c3.html#cb77-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>, <span class="at">caption =</span> <span class="st">&quot;ブロック数を2~5にしたときのmodularity&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb77-25"><a href="c3.html#cb77-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">13</span>, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<table class="table" style="font-size: 13px; width: auto !important; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:tab-cluster-modularity">表3.5: </span>ブロック数を2~5にしたときのmodularity
</caption>
<thead>
<tr>
<th style="text-align:center;">
k
</th>
<th style="text-align:center;">
modularity
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0.2279996
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0.3592285
</td>
</tr>
<tr>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
0.3317726
</td>
</tr>
<tr>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
0.2642927
</td>
</tr>
</tbody>
</table>
<p><br/></p>
<p><code>clValid</code>パッケージの<code>clValid()</code>関数では、様々な指標を用いてクラスター分けが妥当か算出してくれるよう。詳しくは、 <span class="citation">Brock et al. (<a href="#ref-Brock2008" role="doc-biblioref">2008</a>)</span> もしくは<a href="http://www.sthda.com/english/wiki/wiki.php?id_contents=7932">こちら</a>を参照。よく使用される指標であるDunn indexと silhouette widthの結果を見ると、3つのクラスターに分けるのが妥当だと示唆される。</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="c3.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">clValid</span>(<span class="at">obj =</span> groom_mat_b,</span>
<span id="cb78-2"><a href="c3.html#cb78-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">nClust =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb78-3"><a href="c3.html#cb78-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">clMethods =</span> <span class="st">&quot;hierarchical&quot;</span>,</span>
<span id="cb78-4"><a href="c3.html#cb78-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">validation =</span> <span class="st">&quot;internal&quot;</span>,</span>
<span id="cb78-5"><a href="c3.html#cb78-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">Metric =</span> <span class="st">&quot;euclidean&quot;</span>) <span class="ot">-&gt;</span> result</span>
<span id="cb78-6"><a href="c3.html#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="c3.html#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(result)</span></code></pre></div>
<pre><code>## 
## Clustering Methods:
##  hierarchical 
## 
## Cluster sizes:
##  2 3 4 5 
## 
## Validation Measures:
##                                  2       3       4       5
##                                                           
## hierarchical Connectivity   2.9290  5.8579  8.8869 11.9270
##              Dunn           0.8946  1.3325  0.6119  0.6219
##              Silhouette     0.5547  0.5632  0.2284  0.1967
## 
## Optimal Scores:
## 
##              Score  Method       Clusters
## Connectivity 2.9290 hierarchical 2       
## Dunn         1.3325 hierarchical 3       
## Silhouette   0.5632 hierarchical 3</code></pre>
<p>３つのクラスターごとに色分けして図示すると図<a href="c3.html#fig:fig-cluster2">3.15</a>のようになる。</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="c3.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">125</span>)</span>
<span id="cb80-2"><a href="c3.html#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="c3.html#cb80-3" aria-hidden="true" tabindex="-1"></a>graph_groom <span class="sc">%&gt;%</span> </span>
<span id="cb80-4"><a href="c3.html#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tbl_graph</span>(<span class="at">directed =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-5"><a href="c3.html#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 各個体がどのブロックに属するかを指定</span></span>
<span id="cb80-6"><a href="c3.html#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">member =</span> <span class="fu">as.factor</span>(membership_3<span class="sc">$</span>block)) <span class="sc">%&gt;%</span> </span>
<span id="cb80-7"><a href="c3.html#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>(<span class="at">layout =</span> <span class="st">&quot;nicely&quot;</span>)<span class="sc">+</span></span>
<span id="cb80-8"><a href="c3.html#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## ブロックごとに囲む</span></span>
<span id="cb80-9"><a href="c3.html#cb80-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_mark_hull</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y,<span class="at">fill =</span> member),</span>
<span id="cb80-10"><a href="c3.html#cb80-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">concavity =</span> <span class="dv">10</span>)<span class="sc">+</span></span>
<span id="cb80-11"><a href="c3.html#cb80-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> member),<span class="at">shape =</span> <span class="dv">16</span>, <span class="at">size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb80-12"><a href="c3.html#cb80-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="at">start_cap =</span> <span class="fu">circle</span>(<span class="fl">0.5</span>,<span class="st">&quot;cm&quot;</span>),</span>
<span id="cb80-13"><a href="c3.html#cb80-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">end_cap =</span> <span class="fu">circle</span>(<span class="fl">0.5</span>,<span class="st">&quot;cm&quot;</span>),</span>
<span id="cb80-14"><a href="c3.html#cb80-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;grey55&quot;</span>,</span>
<span id="cb80-15"><a href="c3.html#cb80-15" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">width =</span> weight))<span class="sc">+</span></span>
<span id="cb80-16"><a href="c3.html#cb80-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_width</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>))<span class="sc">+</span></span>
<span id="cb80-17"><a href="c3.html#cb80-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>)<span class="sc">+</span></span>
<span id="cb80-18"><a href="c3.html#cb80-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>()<span class="sc">+</span></span>
<span id="cb80-19"><a href="c3.html#cb80-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_nejm</span>()<span class="sc">+</span></span>
<span id="cb80-20"><a href="c3.html#cb80-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_nejm</span>()<span class="sc">+</span></span>
<span id="cb80-21"><a href="c3.html#cb80-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">0.9</span>)<span class="sc">+</span></span>
<span id="cb80-22"><a href="c3.html#cb80-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb80-23"><a href="c3.html#cb80-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-cluster2"></span>
<img src="Network_Analysis_Using_R_files/figure-html/fig-cluster2-1.png" alt="構造類似性に基づいてクラスターごとに色分けした毛づくろい頻度のグラフ" width="576" />
<p class="caption">
図3.15: 構造類似性に基づいてクラスターごとに色分けした毛づくろい頻度のグラフ
</p>
</div>
</div>
</div>
<div id="その他" class="section level3 hasAnchor" number="3.2.7">
<h3><span class="header-section-number">3.2.7</span> その他<a href="c3.html#その他" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>個体間の敵対的交渉の隣接行列を用いた順位序列についての各指標の算出については、筆者の<a href="https://tsubasayamaguchi-jinrui.github.io/Dominance_Analysis/">別稿</a>を参照。ここで紹介しきれなかった他の指標やクラスター分析の手法については、<span class="citation">Whitehead (<a href="#ref-Whitehead2008" role="doc-biblioref">2008</a>)</span> , <span class="citation">Croft et al. (<a href="#ref-Croft2019" role="doc-biblioref">2008</a>)</span> , <span class="citation">鈴木 (<a href="#ref-Suzuki2017" role="doc-biblioref">2017</a>)</span> などを参照。</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-Bala2018" class="csl-entry">
Balasubramaniam, K. N., Beisner, B. A., Berman, C. M., De Marco, A., Duboscq, J., Koirala, S., Majolo, B., Macintosh, A. J. J. J., McFarland, R., Molesti, S., Ogawa, H., Petit, O., Schino, G., Sosa, S., Sueur, C., Thierry, B., Waal, F. B. M. M. de, &amp; McCowan, B. (2018). The influence of phylogeny, social style, and sociodemographic factors on macaque social network structure. <em>Am. J. Primatol.</em>, <em>80</em>(1), e22727.
</div>
<div id="ref-Brock2008" class="csl-entry">
Brock, G., Pihur, V., Datta, S., &amp; Datta, S. (2008). clValid: An <span>R</span> package for cluster validation. <em>J. Stat. Softw.</em>, <em>25</em>, 1–22.
</div>
<div id="ref-Croft2019" class="csl-entry">
Croft, D., James, R., &amp; Krause, J. (2008). <em>動物の社会ネットワーク分析</em> (島田将喜., Trans.). 東海大学出版部.
</div>
<div id="ref-Csardi2006" class="csl-entry">
Csardi, G., Nepusz, T., &amp; Others. (2006). The igraph software package for complex network research. <em>InterJournal, Complex Systems</em>, <em>1695</em>(5), 1–9.
</div>
<div id="ref-Farine2014" class="csl-entry">
Farine, D. R. (2014). Measuring phenotypic assortment in animal social networks: Weighted associations are more robust than binary edges. <em>Anim. Behav.</em>, <em>89</em>, 141–153.
</div>
<div id="ref-Farine2015" class="csl-entry">
Farine, D. R., &amp; Whitehead, H. (2015). Constructing, conducting and interpreting animal social network analysis. <em>J. Anim. Ecol.</em>, <em>84</em>(5), 1144–1163.
</div>
<div id="ref-Newman2004" class="csl-entry">
Newman, M. E. J. (2004). Analysis of weighted networks. <em>Phys. Rev. E Stat. Nonlin. Soft Matter Phys.</em>, <em>70</em>(5 Pt 2), 056131.
</div>
<div id="ref-Page1999" class="csl-entry">
Page, L., Brin, S., Motwani, R., &amp; Winograd, T. (1999). <em>The <span>PageRank</span> citation ranking: Bringing order to the web</em>. Stanford InfoLab.
</div>
<div id="ref-Sosa2020" class="csl-entry">
Sosa, S., Puga-Gonzalez, I., Hu, F., Pansanel, J., Xie, X., &amp; Sueur, C. (2020). A multilevel statistical toolkit to study animal social networks: The animal network toolkit software (<span>ANTs</span>) <span>R</span> package. <em>Sci. Rep.</em>, <em>10</em>(1), 12507.
</div>
<div id="ref-Sueur2011b" class="csl-entry">
Sueur, C., Petit, O., De Marco, A., Jacobs, A. T., Watanabe, K., &amp; Thierry, B. (2011). A comparative network analysis of social style in macaques. <em>Anim. Behav.</em>, <em>82</em>(4), 845–852.
</div>
<div id="ref-Whitehead2008" class="csl-entry">
Whitehead, H. (2008). <em>Analyzing animal societies</em>. The University of Chicago Press.
</div>
<div id="ref-Suzuki2017" class="csl-entry">
鈴木努. (2017). <em>R で学ぶデータサイエンス 8 ネットワーク分析　第2版</em> (金明哲., Ed.). 共立出版.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>分からない場合は<a href="https://manabitimes.jp/math/1008">こちら</a><a href="c3.html#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>分からない場合は<a href="https://manabitimes.jp/math/1153">こちら</a><a href="c3.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>調和平均とは、逆数の平均の逆数である。例えば、1, 2, 4の調和平均は次のようになる。<br />
<span class="math display">\[
\frac{3}{\frac{1}{1} + \frac{1}{2} + \frac{1}{4}} = \frac{1}{\frac{7}{12}} = \frac{12}{7}
\]</span><a href="c3.html#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="c2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="おまけ.-csiの算出.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
